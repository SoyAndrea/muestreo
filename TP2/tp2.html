<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gomez Vargas Andrea, Iummato Luciana, Pesce Andrea Gisele">
<meta name="dcterms.date" content="2024-12-01">

<title>TP 2 - Estratificacion Mesas Electorales Hogares</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="TP2_files/libs/clipboard/clipboard.min.js"></script>
<script src="TP2_files/libs/quarto-html/quarto.js"></script>
<script src="TP2_files/libs/quarto-html/popper.min.js"></script>
<script src="TP2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="TP2_files/libs/quarto-html/anchor.min.js"></script>
<link href="TP2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="TP2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="TP2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="TP2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="TP2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">TP 2 - Estratificacion Mesas Electorales Hogares</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Gomez Vargas Andrea, Iummato Luciana, Pesce Andrea Gisele </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 1, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="paquetes-de-trabajo" class="level1">
<h1>Paquetes de trabajo</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sampling)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(VIM)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(binom)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.which</span>(<span class="st">"make"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                              make 
"C:\\rtools44\\usr\\bin\\make.exe" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stratification)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="page-break-after: always;"></div>
</section>
<section id="ejercicio-1" class="level1">
<h1>Ejercicio 1</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Importar datos</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>marco <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/MESAS_ESCRUTADAS_Cierre.csv"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Explorar datos</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(marco)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Agrupacion"      "Cargo"           "Codigo"          "Distrito"       
 [5] "Establecimiento" "Fecha"           "IdCargo"         "IdCircuito"     
 [9] "IdDistrito"      "IdSeccion"       "Mesa"            "Seccion"        
[13] "electores"       "envio"           "idAgrupacion"    "idAgrupacionInt"
[17] "tipoVoto"        "votos"          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(marco)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,665,130
Columns: 18
$ Agrupacion      &lt;chr&gt; "", "", "", "", "", "JUNTOS POR EL CAMBIO", "FRENTE DE…
$ Cargo           &lt;chr&gt; "DIPUTADOS PROVINCIALES", "DIPUTADOS PROVINCIALES", "D…
$ Codigo          &lt;int&gt; 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 74, 74, 74, 74…
$ Distrito        &lt;chr&gt; "Ciudad Autónoma de Buenos Aires", "Ciudad Autónoma de…
$ Establecimiento &lt;chr&gt; "Colegio Nac. Nº2 D. F. Sarmiento", "Colegio Nac. Nº2 …
$ Fecha           &lt;chr&gt; "14-11-2021 18:30", "14-11-2021 18:30", "14-11-2021 18…
$ IdCargo         &lt;int&gt; 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, …
$ IdCircuito      &lt;chr&gt; "00006", "00006", "00006", "00006", "00006", "00006", …
$ IdDistrito      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ IdSeccion       &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ Mesa            &lt;chr&gt; "09060E", "09060E", "09060E", "09060E", "09060E", "090…
$ Seccion         &lt;chr&gt; "Comuna 01", "Comuna 01", "Comuna 01", "Comuna 01", "C…
$ electores       &lt;int&gt; 346, 346, 346, 346, 346, 346, 346, 346, 346, 346, 350,…
$ envio           &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ idAgrupacion    &lt;int&gt; NA, NA, NA, NA, NA, 501, 502, 504, 503, 187, NA, NA, N…
$ idAgrupacionInt &lt;int&gt; NA, NA, NA, NA, NA, 11, 12, 14, 13, 7, NA, NA, NA, NA,…
$ tipoVoto        &lt;chr&gt; "blancos", "nulos", "recurridos", "comando", "impugnad…
$ votos           &lt;int&gt; 0, 1, 0, 0, 0, 9, 6, 3, 2, 0, 1, 0, 0, 0, 0, 29, 13, 1…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>marco<span class="sc">$</span>Agrupacion<span class="ot">&lt;-</span><span class="fu">as.factor</span>(marco<span class="sc">$</span>Agrupacion)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="qué-cantidad-mínima-de-variables-identifica-una-mesa-electoral-y-un-colegio" class="level2">
<h2 class="anchored" data-anchor-id="qué-cantidad-mínima-de-variables-identifica-una-mesa-electoral-y-un-colegio">1. Qué cantidad mínima de variables identifica una mesa electoral? Y un colegio?</h2>
<pre><code>a. Mesa electoral: Distrito, sección, circuito, establecimiento y el propio código de la mesa

b. Establecimiento: Distrito, sección, circuito, y el propio nombre del establecimiento</code></pre>
</section>
<section id="hallar-la-proporción-de-votos-a-diputados-por-cada-uno-de-los-cuatro-agrupamientos-de-partidos-son-3-segun-el-enunciado-inicial-del-tpfdt-jxc-y-fit" class="level2">
<h2 class="anchored" data-anchor-id="hallar-la-proporción-de-votos-a-diputados-por-cada-uno-de-los-cuatro-agrupamientos-de-partidos-son-3-segun-el-enunciado-inicial-del-tpfdt-jxc-y-fit">2. Hallar la proporción de votos a diputados por cada uno de los cuatro agrupamientos de partidos (son 3 segun el enunciado inicial del TP:FdT, JxC y FIT)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Filtro votos positivos + votos diputados</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>marco_positivos<span class="ot">&lt;-</span>marco <span class="sc">%&gt;%</span> <span class="fu">filter</span>(tipoVoto<span class="sc">==</span><span class="st">"positivo"</span><span class="sc">&amp;</span> Cargo<span class="sc">==</span><span class="st">"DIPUTADOS NACIONALES"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Elimino algunas variables</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>marco_positivos<span class="sc">$</span>Codigo <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>marco_positivos<span class="sc">$</span>Fecha <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>marco_positivos<span class="sc">$</span>Cargo <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>marco_positivos<span class="sc">$</span>envio <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>marco_positivos<span class="sc">$</span>idAgrupacion <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>marco_positivos<span class="sc">$</span>idCargo <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>marco_positivos<span class="sc">$</span>idAgrupacionInt <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>total_votos <span class="ot">&lt;-</span> marco_positivos <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_votos =</span> <span class="fu">sum</span>(votos)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(total_votos)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>total_votos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 23238621</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Recodificar partidos</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>marco_positivos<span class="sc">$</span>Partido <span class="ot">&lt;-</span> <span class="st">"Resto"</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>marco_positivos<span class="sc">$</span>Partido <span class="ot">&lt;-</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(<span class="fu">substr</span>(marco_positivos<span class="sc">$</span>Agrupacion,<span class="dv">1</span>,<span class="dv">15</span>)<span class="sc">==</span><span class="st">"FRENTE DE TODOS"</span>,<span class="st">"FdT"</span>,marco_positivos<span class="sc">$</span>Partido)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>marco_positivos<span class="sc">$</span>Partido <span class="ot">&lt;-</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(<span class="fu">substr</span>(marco_positivos<span class="sc">$</span>Agrupacion,<span class="dv">1</span>,<span class="dv">19</span>)<span class="sc">==</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>           <span class="st">"FRENTE DE IZQUIERDA"</span>,<span class="st">"FIT"</span>,marco_positivos<span class="sc">$</span>Partido)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>marco_positivos<span class="sc">$</span>Partido <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">substr</span>(marco_positivos<span class="sc">$</span>Agrupacion,<span class="dv">1</span>,<span class="dv">6</span>)<span class="sc">==</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"JUNTOS"</span>,<span class="st">"Juntos"</span>,marco_positivos<span class="sc">$</span>Partido)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#proporción de voto a diputados por partidos</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>proporciones<span class="ot">&lt;-</span>marco_positivos <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Partido) <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">votos_agrupacion=</span> <span class="fu">sum</span>(votos),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">proporcion=</span> <span class="fu">round</span>(votos_agrupacion<span class="sc">/</span>total_votos<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>proporciones</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  Partido votos_agrupacion proporcion
  &lt;chr&gt;              &lt;int&gt;      &lt;dbl&gt;
1 FIT              1194947        5.1
2 FdT              7339755       31.6
3 Juntos           7973281       34.3
4 Resto            6730638       29  </code></pre>
</div>
</div>
</section>
<section id="tabular-la-cantidad-de-colegios-electorales-mesas-electorales-y-electores-por-estrato" class="level2">
<h2 class="anchored" data-anchor-id="tabular-la-cantidad-de-colegios-electorales-mesas-electorales-y-electores-por-estrato">3. Tabular la cantidad de colegios electorales, mesas electorales y electores por Estrato</h2>
<p>6 estratos: CABA, Partidos del Gran Buenos Aires, Resto de Buenos Aires, Región Pampeana (Córdoba, Santa Fé, La Pampa, Entre Ríos), NEA - NOA, Resto</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#creación variable estratos</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(marco_positivos<span class="sc">$</span>Distrito)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
                                         Buenos Aires 
                                               217470 
                                            Catamarca 
                                                 5015 
                                                Chaco 
                                                14020 
                                               Chubut 
                                                 6565 
                      Ciudad Autónoma de Buenos Aires 
                                                36670 
                                              Córdoba 
                                                62013 
                                           Corrientes 
                                                10344 
                                           Entre Ríos 
                                                23373 
                                              Formosa 
                                                 4224 
                                                Jujuy 
                                                 5112 
                                             La Pampa 
                                                 4400 
                                             La Rioja 
                                                 4585 
                                              Mendoza 
                                                29344 
                                             Misiones 
                                                13755 
                                              Neuquén 
                                                11074 
                                            Río Negro 
                                                10038 
                                                Salta 
                                                21875 
                                             San Juan 
                                                 6860 
                                             San Luis 
                                                 6135 
                                           Santa Cruz 
                                                 4370 
                                             Santa Fe 
                                                73152 
                                  Santiago del Estero 
                                                16359 
Tierra del Fuego, Antártida e Islas del Atlántico Sur 
                                                 3409 
                                              Tucumán 
                                                18770 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>GBA <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Avellaneda"</span>,<span class="st">"Almirante Brown"</span>,<span class="st">"Berazategui"</span>,<span class="st">"Esteban Echeverría"</span>,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Ezeiza"</span>,<span class="st">"Florencio Varela"</span>,<span class="st">"General San Martín"</span>,<span class="st">"Hurlingham"</span>,<span class="st">"Ituzaingó"</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">"José C. Paz"</span>,<span class="st">"La Matanza"</span>,<span class="st">"Lanús"</span>,<span class="st">"Lomas de Zamora"</span>,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Malvinas Argentinas"</span>,<span class="st">"Merlo"</span>,<span class="st">"Moreno"</span>,<span class="st">"Morón"</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">"Quilmes"</span>,<span class="st">"San Fernando"</span>,<span class="st">"San Isidro"</span>,<span class="st">"San Miguel"</span>,<span class="st">"Tigre"</span>,<span class="st">"Tres de Febrero"</span>,<span class="st">"Vicente López"</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>marco_positivos<span class="ot">&lt;-</span>  marco_positivos <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">estrato =</span><span class="fu">case_when</span>(</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  Distrito<span class="sc">==</span> <span class="st">"Ciudad Autónoma de Buenos Aires"</span> <span class="sc">~</span> <span class="st">"CABA"</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  Distrito<span class="sc">==</span> <span class="st">"Córdoba"</span> <span class="sc">|</span> Distrito<span class="sc">==</span> <span class="st">"Entre Ríos"</span><span class="sc">|</span> Distrito<span class="sc">==</span> <span class="st">"La Pampa"</span><span class="sc">|</span> Distrito<span class="sc">==</span> <span class="st">"Santa Fe"</span>  <span class="sc">~</span> <span class="st">"Región_pampeana"</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  Distrito<span class="sc">==</span> <span class="st">"Chaco"</span> <span class="sc">|</span> Distrito<span class="sc">==</span> <span class="st">"Catamarca"</span><span class="sc">|</span> Distrito<span class="sc">==</span> <span class="st">"Corrientes"</span><span class="sc">|</span> Distrito<span class="sc">==</span> <span class="st">"Formosa"</span>  <span class="sc">|</span> Distrito<span class="sc">==</span> <span class="st">"Santiago del Estero"</span>  <span class="sc">|</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  Distrito<span class="sc">==</span> <span class="st">"Jujuy"</span> <span class="sc">|</span> Distrito<span class="sc">==</span> <span class="st">"Misiones"</span><span class="sc">|</span> Distrito<span class="sc">==</span> <span class="st">"La Rioja"</span><span class="sc">|</span> Distrito<span class="sc">==</span> <span class="st">"Salta"</span><span class="sc">|</span> Distrito<span class="sc">==</span> <span class="st">"Tucumán"</span><span class="sc">~</span> <span class="st">"NEA_NOA"</span>,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  Seccion <span class="sc">%in%</span> GBA <span class="sc">&amp;</span> Distrito<span class="sc">==</span> <span class="st">"Buenos Aires"</span><span class="sc">~</span> <span class="st">"GBA"</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="sc">!</span>Seccion <span class="sc">%in%</span> GBA <span class="sc">&amp;</span> Distrito<span class="sc">==</span> <span class="st">"Buenos Aires"</span> <span class="sc">~</span> <span class="st">"Resto_BsAs"</span>,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>   <span class="cn">TRUE</span><span class="sc">~</span><span class="st">"Resto_país"</span>))</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(marco_positivos<span class="sc">$</span>Distrito,marco_positivos<span class="sc">$</span>estrato)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                       
                                                          CABA    GBA NEA_NOA
  Buenos Aires                                               0 129474       0
  Catamarca                                                  0      0    5015
  Chaco                                                      0      0   14020
  Chubut                                                     0      0       0
  Ciudad Autónoma de Buenos Aires                        36670      0       0
  Córdoba                                                    0      0       0
  Corrientes                                                 0      0   10344
  Entre Ríos                                                 0      0       0
  Formosa                                                    0      0    4224
  Jujuy                                                      0      0    5112
  La Pampa                                                   0      0       0
  La Rioja                                                   0      0    4585
  Mendoza                                                    0      0       0
  Misiones                                                   0      0   13755
  Neuquén                                                    0      0       0
  Río Negro                                                  0      0       0
  Salta                                                      0      0   21875
  San Juan                                                   0      0       0
  San Luis                                                   0      0       0
  Santa Cruz                                                 0      0       0
  Santa Fe                                                   0      0       0
  Santiago del Estero                                        0      0   16359
  Tierra del Fuego, Antártida e Islas del Atlántico Sur      0      0       0
  Tucumán                                                    0      0   18770
                                                       
                                                        Región_pampeana
  Buenos Aires                                                        0
  Catamarca                                                           0
  Chaco                                                               0
  Chubut                                                              0
  Ciudad Autónoma de Buenos Aires                                     0
  Córdoba                                                         62013
  Corrientes                                                          0
  Entre Ríos                                                      23373
  Formosa                                                             0
  Jujuy                                                               0
  La Pampa                                                         4400
  La Rioja                                                            0
  Mendoza                                                             0
  Misiones                                                            0
  Neuquén                                                             0
  Río Negro                                                           0
  Salta                                                               0
  San Juan                                                            0
  San Luis                                                            0
  Santa Cruz                                                          0
  Santa Fe                                                        73152
  Santiago del Estero                                                 0
  Tierra del Fuego, Antártida e Islas del Atlántico Sur               0
  Tucumán                                                             0
                                                       
                                                        Resto_BsAs Resto_país
  Buenos Aires                                               87996          0
  Catamarca                                                      0          0
  Chaco                                                          0          0
  Chubut                                                         0       6565
  Ciudad Autónoma de Buenos Aires                                0          0
  Córdoba                                                        0          0
  Corrientes                                                     0          0
  Entre Ríos                                                     0          0
  Formosa                                                        0          0
  Jujuy                                                          0          0
  La Pampa                                                       0          0
  La Rioja                                                       0          0
  Mendoza                                                        0      29344
  Misiones                                                       0          0
  Neuquén                                                        0      11074
  Río Negro                                                      0      10038
  Salta                                                          0          0
  San Juan                                                       0       6860
  San Luis                                                       0       6135
  Santa Cruz                                                     0       4370
  Santa Fe                                                       0          0
  Santiago del Estero                                            0          0
  Tierra del Fuego, Antártida e Islas del Atlántico Sur          0       3409
  Tucumán                                                        0          0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creación de tabla de estratos </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>tabla_estratos0 <span class="ot">&lt;-</span>marco_positivos <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(estrato,Distrito,IdSeccion,IdCircuito, Establecimiento,Mesa) <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">electores =</span> <span class="fu">first</span>(electores), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>tabla_estratos1<span class="ot">&lt;-</span>tabla_estratos0 <span class="sc">%&gt;%</span> </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">group_by</span>(estrato,Distrito,IdSeccion,IdCircuito, Establecimiento) <span class="sc">%&gt;%</span> </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">summarise</span>(<span class="at">mesas=</span> <span class="fu">n</span>(),</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">electores =</span> <span class="fu">sum</span>(electores))</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>tabla_estratos_final <span class="ot">&lt;-</span> tabla_estratos1 <span class="sc">%&gt;%</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a> <span class="fu">group_by</span>(estrato) <span class="sc">%&gt;%</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a> <span class="fu">summarise</span>(</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a> <span class="at">Establecimientos =</span> <span class="fu">n</span>(),</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a> <span class="at">TotalMesas =</span> <span class="fu">sum</span>(mesas),</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a> <span class="at">TotalElectores =</span> <span class="fu">sum</span>(electores)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>tabla_estratos_final</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  estrato         Establecimientos TotalMesas TotalElectores
  &lt;chr&gt;                      &lt;int&gt;      &lt;int&gt;          &lt;int&gt;
1 CABA                        1021       7334        2535912
2 GBA                         3270      21579        7547222
3 NEA_NOA                     3832      22389        7503865
4 Región_pampeana             3757      21206        7137693
5 Resto_BsAs                  2840      14666        4983390
6 Resto_país                  2222      13063        4318698</code></pre>
</div>
</div>
</section>
<section id="construir-a-partir-del-archivo-dado-una-tabla-de-mesas-electorales-lo-necesitaremos-más-adelantecada-una-con-el-total-de-votos-a-cada-partido-el-total-de-votos-positivos-y-las-variables-de-identificación." class="level2">
<h2 class="anchored" data-anchor-id="construir-a-partir-del-archivo-dado-una-tabla-de-mesas-electorales-lo-necesitaremos-más-adelantecada-una-con-el-total-de-votos-a-cada-partido-el-total-de-votos-positivos-y-las-variables-de-identificación.">4. Construir a partir del archivo dado una tabla de mesas electorales (lo necesitaremos más adelante),cada una con el total de votos a cada partido, el total de votos positivos y las variables de identificación.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>tabla_votos_mesa <span class="ot">&lt;-</span>marco_positivos <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(estrato,Distrito, IdSeccion,IdCircuito, Establecimiento,Mesa,Partido) <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Voto =</span> <span class="fu">sum</span>(votos,<span class="at">na.rm =</span> <span class="cn">TRUE</span>))<span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Partido, </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> Voto)<span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reemplaza NAs por 0 en las columnas de votos</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">FdT =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(FdT), <span class="dv">0</span>, FdT),</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Juntos =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(Juntos), <span class="dv">0</span>, Juntos),</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">FIT =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(FIT), <span class="dv">0</span>, FIT),</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Resto =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(Resto), <span class="dv">0</span>, Resto),</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcula el total con los valores de votos</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Total =</span> FdT <span class="sc">+</span> Juntos <span class="sc">+</span> FIT <span class="sc">+</span> Resto</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tabla_votos_mesa) <span class="co"># mostramos los primeros 10 resultados</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 11
  estrato Distrito IdSeccion IdCircuito Establecimiento Mesa    FIT   FdT Juntos
  &lt;chr&gt;   &lt;chr&gt;        &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 CABA    Ciudad …         1 00001      CENOF Centro I… 0002…    22    76     79
2 CABA    Ciudad …         1 00001      CENOF Centro I… 0002…    20    72     93
3 CABA    Ciudad …         1 00001      CENOF Centro I… 0002…    26    70     80
4 CABA    Ciudad …         1 00001      Esc. Integral … 0001…    28    81     69
5 CABA    Ciudad …         1 00001      Esc. Integral … 0002…    25    70     98
6 CABA    Ciudad …         1 00001      Esc. Integral … 0002…    23    82     94
# ℹ 2 more variables: Resto &lt;dbl&gt;, Total &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="a-partir-de-la-tabla-de-mesas-electorales-construir-la-tabla-de-colegios-electorales-cada-uno-con-el-total-de-votos-a-cada-partido-el-total-de-votos-positivos-y-las-variables-de-identificación." class="level2">
<h2 class="anchored" data-anchor-id="a-partir-de-la-tabla-de-mesas-electorales-construir-la-tabla-de-colegios-electorales-cada-uno-con-el-total-de-votos-a-cada-partido-el-total-de-votos-positivos-y-las-variables-de-identificación.">5. A partir de la tabla de mesas electorales construir la tabla de colegios electorales, cada uno con el total de votos a cada partido, el total de votos positivos y las variables de identificación.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>tabla_votos_establecimiento <span class="ot">&lt;-</span>marco_positivos <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(estrato,Distrito, IdSeccion,IdCircuito, Establecimiento,Partido) <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Voto =</span> <span class="fu">sum</span>(votos,<span class="at">na.rm =</span> <span class="cn">TRUE</span>))<span class="sc">%&gt;%</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Partido, </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> Voto)<span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reemplaza NAs por 0 en las columnas de votos</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">FdT =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(FdT), <span class="dv">0</span>, FdT),</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Juntos =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(Juntos), <span class="dv">0</span>, Juntos),</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">FIT =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(FIT), <span class="dv">0</span>, FIT),</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Resto =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(Resto), <span class="dv">0</span>, Resto),</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcula el total con los valores de votos</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Total =</span> FdT <span class="sc">+</span> Juntos <span class="sc">+</span> FIT <span class="sc">+</span> Resto</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tabla_votos_establecimiento)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 10
  estrato Distrito IdSeccion IdCircuito Establecimiento   FIT   FdT Juntos Resto
  &lt;chr&gt;   &lt;chr&gt;        &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
1 CABA    Ciudad …         1 00001      CENOF Centro I…    68   218    252   152
2 CABA    Ciudad …         1 00001      Esc. Integral …    76   233    261   127
3 CABA    Ciudad …         1 00001      Esc. N°4 Baldo…    65   227    265   154
4 CABA    Ciudad …         1 00001      Esc. Nº26 Hipó…   212   717    807   386
5 CABA    Ciudad …         1 00001      Esc. Nº27 Dean…    80   229    274   153
6 CABA    Ciudad …         1 00001      Esc. Nº3 Berna…    57   235    274   156
# ℹ 1 more variable: Total &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="tabular-y-graficar-los-tres-totales-y-los-tres-porcentajes-poblacionales-a-estimar" class="level2">
<h2 class="anchored" data-anchor-id="tabular-y-graficar-los-tres-totales-y-los-tres-porcentajes-poblacionales-a-estimar">6. Tabular y graficar los tres totales y los tres porcentajes poblacionales a estimar</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Tabla</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>totales <span class="ot">&lt;-</span> tabla_votos_establecimiento <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Total_FdT =</span> <span class="fu">sum</span>(FdT,<span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Total_Juntos =</span> <span class="fu">sum</span>(Juntos,<span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Total_FIT =</span> <span class="fu">sum</span>(FIT,<span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Total_Resto =</span> <span class="fu">sum</span>(Resto,<span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Total_votos =</span> <span class="fu">sum</span>(Total,<span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Porcentaje_FdT =</span> <span class="fu">round</span>(Total_FdT<span class="sc">/</span>Total_votos<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>),</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Porcentaje_Juntos =</span> <span class="fu">round</span>(Total_Juntos<span class="sc">/</span>Total_votos<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>),</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Porcentaje_FIT =</span> <span class="fu">round</span>(Total_FIT<span class="sc">/</span>Total_votos<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>),</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Porcentaje_Resto =</span> <span class="fu">round</span>(Total_Resto<span class="sc">/</span>Total_votos<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>totales</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 9
  Total_FdT Total_Juntos Total_FIT Total_Resto Total_votos Porcentaje_FdT
      &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;          &lt;dbl&gt;
1   7339755      7973281   1194947     6730638    23238621           31.6
# ℹ 3 more variables: Porcentaje_Juntos &lt;dbl&gt;, Porcentaje_FIT &lt;dbl&gt;,
#   Porcentaje_Resto &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Gráfico</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>totales_long <span class="ot">&lt;-</span> totales <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Porcentaje_FdT, Porcentaje_FIT, Porcentaje_Juntos) <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Partido"</span>, <span class="at">values_to =</span> <span class="st">"Porcentaje"</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Limpiar los nombres de los partidos</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>totales_long<span class="sc">$</span>Partido <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"_Porcentaje"</span>, <span class="st">""</span>, totales_long<span class="sc">$</span>Partido)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(totales_long, <span class="fu">aes</span>(<span class="at">x =</span> Partido, <span class="at">y =</span> Porcentaje, <span class="at">fill =</span> Partido)) <span class="sc">+</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> <span class="co"># Gráfico de barras</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(Porcentaje, <span class="st">"%"</span>)),  <span class="co"># Agregar etiquetas con porcentajes</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span>              <span class="co"># Ajustar posición y tamaño del texto</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">40</span>)) <span class="sc">+</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Porcentaje de votos por partido"</span>,</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Partidos"</span>,</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Porcentaje de votos"</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set3"</span>) <span class="sc">+</span> <span class="co"># Escala de colores agradable </span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TP2_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="seleccionar-con-sampling-una-muestra-de-colegios-con-cada-estrategia" class="level2">
<h2 class="anchored" data-anchor-id="seleccionar-con-sampling-una-muestra-de-colegios-con-cada-estrategia">7. Seleccionar con sampling una muestra de colegios con cada estrategia</h2>
<section id="estrategia-1-con-mas" class="level3">
<h3 class="anchored" data-anchor-id="estrategia-1-con-mas">Estrategia 1 con MAS</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cantidad de estratos </span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>H<span class="ot">=</span><span class="dv">6</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#tamaño muestra establecimientos</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="dv">400</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">#tamaño universo establecimientos</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>N<span class="ot">=</span><span class="fu">sum</span>(tabla_estratos_final<span class="sc">$</span>Establecimientos) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creo variables para ponderar la muestra en mi marco</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>tabla_estratos_final<span class="ot">&lt;-</span>tabla_estratos_final <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pesos=</span>Establecimientos<span class="sc">/</span>N,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_prop=</span> <span class="fu">round</span>(n<span class="sc">*</span>TotalElectores<span class="sc">/</span><span class="fu">sum</span>(TotalElectores)))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Control</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(tabla_estratos_final<span class="sc">$</span>n_prop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 401</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Agrego fpc a marco muestral (establecimientos por estrato?)</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>tabla_votos_establecimiento <span class="ot">&lt;-</span>  tabla_votos_establecimiento <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(estrato) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fpc=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Ordeno el marco de muestreo por estrato (lo pide sampling)</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>tabla_votos_establecimiento <span class="ot">&lt;-</span>  tabla_votos_establecimiento[<span class="fu">order</span>(tabla_votos_establecimiento<span class="sc">$</span>estrato),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Selección de muestra</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>smplMAS <span class="ot">=</span> sampling<span class="sc">::</span><span class="fu">strata</span>(tabla_votos_establecimiento, <span class="at">stratanames =</span> <span class="fu">c</span>(<span class="st">"estrato"</span>) , </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">size=</span>tabla_estratos_final<span class="sc">$</span>n_prop , <span class="at">description=</span><span class="cn">TRUE</span>, </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">method =</span> <span class="st">"srswor"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Stratum 1 

Population total and number of selected units: 1021 30 
Stratum 2 

Population total and number of selected units: 3270 89 
Stratum 3 

Population total and number of selected units: 3832 88 
Stratum 4 

Population total and number of selected units: 3757 84 
Stratum 5 

Population total and number of selected units: 2840 59 
Stratum 6 

Population total and number of selected units: 2222 51 
Number of strata  6 
Total number of selected units 401 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recupero datos del marco de muestreo</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>muestra_casos <span class="ot">&lt;-</span> sampling<span class="sc">::</span><span class="fu">getdata</span>(tabla_votos_establecimiento,smplMAS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculo el factor de expansion utilizando probabilidad de seleccion calculada </span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>muestra_casos<span class="sc">$</span>pondera <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>muestra_casos<span class="sc">$</span>Prob</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="calcular-con-survey-las-estimaciones-pedidas-junto-a-sus-cv-ic90-y-deff." class="level2">
<h2 class="anchored" data-anchor-id="calcular-con-survey-las-estimaciones-pedidas-junto-a-sus-cv-ic90-y-deff.">8. Calcular con survey las estimaciones pedidas, junto a sus CV, IC(90%) y deff.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Le indico a survey el diseno de muestra</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Indico fpc por estrato</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>diseno <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">svydesign</span>(<span class="at">id=</span><span class="sc">~</span><span class="dv">1</span>, <span class="at">strata =</span> <span class="sc">~</span>estrato, </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">weights =</span> <span class="sc">~</span>pondera,  <span class="at">data=</span>muestra_casos,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">fpc =</span> <span class="sc">~</span>fpc)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>diseno</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Stratified Independent Sampling design
survey::svydesign(id = ~1, strata = ~estrato, weights = ~pondera, 
    data = muestra_casos, fpc = ~fpc)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Estimaciones de totales</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># FdT</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>EstimTotalFdT <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">svytotal</span>(<span class="sc">~</span>FdT, diseno, <span class="at">deff=</span><span class="cn">TRUE</span>, <span class="at">cv=</span><span class="cn">TRUE</span> )</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>EstimTotalFdT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      total      SE   DEff
FdT 7296278  256585 0.8649</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cv</span>(EstimTotalFdT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           FdT
FdT 0.03516657</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">deff</span>(EstimTotalFdT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      FdT 
0.8648998 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(EstimTotalFdT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      2.5 %  97.5 %
FdT 6793380 7799175</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># FIT</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>EstimTotalFIT <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">svytotal</span>(<span class="sc">~</span>FIT, diseno, <span class="at">deff=</span><span class="cn">TRUE</span>, <span class="at">cv=</span><span class="cn">TRUE</span> )</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>EstimTotalFIT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      total      SE   DEff
FIT 1163874   56026 0.7577</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cv</span>(EstimTotalFIT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          FIT
FIT 0.0481371</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">deff</span>(EstimTotalFIT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     FIT 
0.757744 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(EstimTotalFdT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      2.5 %  97.5 %
FdT 6793380 7799175</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Juntos</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>EstimTotalJuntos <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">svytotal</span>(<span class="sc">~</span>Juntos, diseno, <span class="at">deff=</span><span class="cn">TRUE</span>, <span class="at">cv=</span><span class="cn">TRUE</span> )</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>EstimTotalJuntos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         total      SE   DEff
Juntos 8259274  311852 0.7791</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cv</span>(EstimTotalJuntos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Juntos
Juntos 0.03775779</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">deff</span>(EstimTotalJuntos)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Juntos 
0.7791112 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(EstimTotalFdT)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      2.5 %  97.5 %
FdT 6793380 7799175</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Dataframe de totales</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="co">#FdT</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer el total y el error estándar</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>total <span class="ot">&lt;-</span> <span class="fu">coef</span>(EstimTotalFdT)  <span class="co"># Estimación del total</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">SE</span>(EstimTotalFdT)       <span class="co"># Error estándar</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer coeficiente de variación y diseño efectivo</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>cv_val <span class="ot">&lt;-</span> <span class="fu">cv</span>(EstimTotalFdT)   <span class="co"># Coeficiente de variación</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>deff_val <span class="ot">&lt;-</span> <span class="fu">deff</span>(EstimTotalFdT)  <span class="co"># Diseño efectivo</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer el intervalo de confianza</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>conf <span class="ot">&lt;-</span> <span class="fu">confint</span>(EstimTotalFdT)  <span class="co"># Intervalo de confianza</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un data.frame con los resultados</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>resultados_totalesFdT <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Total =</span> total,</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">SE =</span> se,</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">CV =</span> cv_val,</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">Deff =</span> deff_val,</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_Lower =</span> conf[, <span class="dv">1</span>],  <span class="co"># Límite inferior del intervalo de confianza</span></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_Upper =</span> conf[, <span class="dv">2</span>]   <span class="co"># Límite superior del intervalo de confianza</span></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a><span class="co">#FIT</span></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer el total y el error estándar</span></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>total <span class="ot">&lt;-</span> <span class="fu">coef</span>(EstimTotalFIT)  <span class="co"># Estimación del total</span></span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">SE</span>(EstimTotalFIT)       <span class="co"># Error estándar</span></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer coeficiente de variación y diseño efectivo</span></span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>cv_val <span class="ot">&lt;-</span> <span class="fu">cv</span>(EstimTotalFIT)   <span class="co"># Coeficiente de variación</span></span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>deff_val <span class="ot">&lt;-</span> <span class="fu">deff</span>(EstimTotalFIT)  <span class="co"># Diseño efectivo</span></span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer el intervalo de confianza</span></span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a>conf <span class="ot">&lt;-</span> <span class="fu">confint</span>(EstimTotalFIT)  <span class="co"># Intervalo de confianza</span></span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un data.frame con los resultados</span></span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a>resultados_totalesFIT <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">Total =</span> total,</span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">SE =</span> se,</span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">CV =</span> cv_val,</span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">Deff =</span> deff_val,</span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_Lower =</span> conf[, <span class="dv">1</span>],  <span class="co"># Límite inferior del intervalo de confianza</span></span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_Upper =</span> conf[, <span class="dv">2</span>]   <span class="co"># Límite superior del intervalo de confianza</span></span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-45"><a href="#cb66-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-46"><a href="#cb66-46" aria-hidden="true" tabindex="-1"></a><span class="co">#Juntos</span></span>
<span id="cb66-47"><a href="#cb66-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer el total y el error estándar</span></span>
<span id="cb66-48"><a href="#cb66-48" aria-hidden="true" tabindex="-1"></a>total <span class="ot">&lt;-</span> <span class="fu">coef</span>(EstimTotalJuntos)  <span class="co"># Estimación del total</span></span>
<span id="cb66-49"><a href="#cb66-49" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">SE</span>(EstimTotalJuntos)       <span class="co"># Error estándar</span></span>
<span id="cb66-50"><a href="#cb66-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-51"><a href="#cb66-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer coeficiente de variación y diseño efectivo</span></span>
<span id="cb66-52"><a href="#cb66-52" aria-hidden="true" tabindex="-1"></a>cv_val <span class="ot">&lt;-</span> <span class="fu">cv</span>(EstimTotalJuntos)   <span class="co"># Coeficiente de variación</span></span>
<span id="cb66-53"><a href="#cb66-53" aria-hidden="true" tabindex="-1"></a>deff_val <span class="ot">&lt;-</span> <span class="fu">deff</span>(EstimTotalJuntos)  <span class="co"># Diseño efectivo</span></span>
<span id="cb66-54"><a href="#cb66-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-55"><a href="#cb66-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer el intervalo de confianza</span></span>
<span id="cb66-56"><a href="#cb66-56" aria-hidden="true" tabindex="-1"></a>conf <span class="ot">&lt;-</span> <span class="fu">confint</span>(EstimTotalJuntos)  <span class="co"># Intervalo de confianza</span></span>
<span id="cb66-57"><a href="#cb66-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-58"><a href="#cb66-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un data.frame con los resultados</span></span>
<span id="cb66-59"><a href="#cb66-59" aria-hidden="true" tabindex="-1"></a>resultados_totalesJuntos <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb66-60"><a href="#cb66-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">Total =</span> total,</span>
<span id="cb66-61"><a href="#cb66-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">SE =</span> se,</span>
<span id="cb66-62"><a href="#cb66-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">CV =</span> cv_val,</span>
<span id="cb66-63"><a href="#cb66-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">Deff =</span> deff_val,</span>
<span id="cb66-64"><a href="#cb66-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_Lower =</span> conf[, <span class="dv">1</span>],  <span class="co"># Límite inferior del intervalo de confianza</span></span>
<span id="cb66-65"><a href="#cb66-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_Upper =</span> conf[, <span class="dv">2</span>] </span>
<span id="cb66-66"><a href="#cb66-66" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-67"><a href="#cb66-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-68"><a href="#cb66-68" aria-hidden="true" tabindex="-1"></a><span class="co">#Renombrar columnas</span></span>
<span id="cb66-69"><a href="#cb66-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-70"><a href="#cb66-70" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(resultados_totalesFdT) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb66-71"><a href="#cb66-71" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Total"</span>,</span>
<span id="cb66-72"><a href="#cb66-72" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Error Estándar (SE)"</span>,</span>
<span id="cb66-73"><a href="#cb66-73" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Coeficiente de Variación (CV)"</span>,</span>
<span id="cb66-74"><a href="#cb66-74" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Diseño Efectivo (Deff)"</span>,</span>
<span id="cb66-75"><a href="#cb66-75" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IC Inferior"</span>,</span>
<span id="cb66-76"><a href="#cb66-76" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IC Superior"</span></span>
<span id="cb66-77"><a href="#cb66-77" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-78"><a href="#cb66-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Ver los resultados</span></span>
<span id="cb66-79"><a href="#cb66-79" aria-hidden="true" tabindex="-1"></a>resultados_totalesFdT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Total Error Estándar (SE) Coeficiente de Variación (CV)
FdT 7296278              256585                    0.03516657
    Diseño Efectivo (Deff) IC Inferior IC Superior
FdT              0.8648998     6793380     7799175</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(resultados_totalesFIT) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Total"</span>,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Error Estándar (SE)"</span>,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Coeficiente de Variación (CV)"</span>,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Diseño Efectivo (Deff)"</span>,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IC Inferior"</span>,</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IC Superior"</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Ver los resultados</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>resultados_totalesFIT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Total Error Estándar (SE) Coeficiente de Variación (CV)
FIT 1163874             56025.5                     0.0481371
    Diseño Efectivo (Deff) IC Inferior IC Superior
FIT               0.757744     1054066     1273682</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(resultados_totalesJuntos) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Total"</span>,</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Error Estándar (SE)"</span>,</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Coeficiente de Variación (CV)"</span>,</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Diseño Efectivo (Deff)"</span>,</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IC Inferior"</span>,</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IC Superior"</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Ver los resultados</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>resultados_totalesJuntos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Total Error Estándar (SE) Coeficiente de Variación (CV)
Juntos 8259274            311851.9                    0.03775779
       Diseño Efectivo (Deff) IC Inferior IC Superior
Juntos              0.7791112     7648055     8870492</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Estimaciones de proporciones</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co"># FdT</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>Proporcion_FdT <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">svyratio</span>(<span class="sc">~</span>FdT , <span class="sc">~</span>Total, diseno, <span class="at">deff=</span><span class="cn">TRUE</span> )</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>Proporcion_FdT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ratio estimator: svyratio.survey.design2(~FdT, ~Total, diseno, deff = TRUE)
Ratios=
        Total
FdT 0.3166921
SEs=
          Total
FdT 0.008003004</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>df_ratio_FdT <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Proporcion_FdT[[<span class="dv">1</span>]])</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>df_SE_FdT    <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="fu">sqrt</span>(Proporcion_FdT[[<span class="dv">2</span>]]))</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>CV_FdT       <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">cv</span>(Proporcion_FdT)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>df_IC_FdT    <span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">confint</span>(Proporcion_FdT))</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>df_proporcion_FdT <span class="ot">&lt;-</span> <span class="fu">cbind</span>(df_ratio_FdT, df_SE_FdT,df_IC_FdT)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>df_proporcion_FdT<span class="sc">$</span>CV  <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span>CV_FdT[<span class="dv">1</span>,<span class="dv">1</span>] </span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>df_proporcion_FdT<span class="sc">$</span>deff  <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">deff</span>(Proporcion_FdT) </span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_proporcion_FdT) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Proporción"</span>, <span class="st">"Error Estándar (SE)"</span>, <span class="st">"IC Inferior"</span>, <span class="st">"IC Superior"</span>, <span class="st">"Coeficiente de Variación (CV)"</span>, <span class="st">"Diseño Efectivo (Deff)"</span>)</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>df_proporcion_FdT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Proporción Error Estándar (SE) IC Inferior IC Superior
FdT  0.3166921         0.008003004   0.3010065   0.3323777
    Coeficiente de Variación (CV) Diseño Efectivo (Deff)
FdT                      2.527061              0.8552909</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># FIT</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>Proporcion_FIT <span class="ot">&lt;-</span> survey <span class="sc">::</span> <span class="fu">svyratio</span>(<span class="sc">~</span>FIT , <span class="sc">~</span>Total, diseno, <span class="at">deff=</span><span class="cn">TRUE</span> )</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>Proporcion_FIT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ratio estimator: svyratio.survey.design2(~FIT, ~Total, diseno, deff = TRUE)
Ratios=
         Total
FIT 0.05051749
SEs=
          Total
FIT 0.002111681</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>df_ratio_FIT <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Proporcion_FIT[[<span class="dv">1</span>]])</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>df_SE_FIT    <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="fu">sqrt</span>(Proporcion_FIT[[<span class="dv">2</span>]]))</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>CV_FIT       <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">cv</span>(Proporcion_FIT)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>df_IC_FIT    <span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">confint</span>(Proporcion_FIT))</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>df_proporcion_FIT <span class="ot">&lt;-</span> <span class="fu">cbind</span>(df_ratio_FIT, df_SE_FIT,df_IC_FIT)</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>df_proporcion_FIT<span class="sc">$</span>CV  <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span>CV_FIT[<span class="dv">1</span>,<span class="dv">1</span>] </span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>df_proporcion_FIT<span class="sc">$</span>deff  <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">deff</span>(Proporcion_FIT) </span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_proporcion_FIT) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Proporción"</span>, <span class="st">"Error Estándar (SE)"</span>, <span class="st">"IC Inferior"</span>, <span class="st">"IC Superior"</span>, <span class="st">"Coeficiente de Variación (CV)"</span>, <span class="st">"Diseño Efectivo (Deff)"</span>)</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>df_proporcion_FIT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Proporción Error Estándar (SE) IC Inferior IC Superior
FIT 0.05051749         0.002111681  0.04637867  0.05465631
    Coeficiente de Variación (CV) Diseño Efectivo (Deff)
FIT                      4.180098              0.8201744</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Juntos</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>Proporcion_Juntos <span class="ot">&lt;-</span> survey <span class="sc">::</span> <span class="fu">svyratio</span>(<span class="sc">~</span>Juntos , <span class="sc">~</span>Total, diseno, <span class="at">deff=</span><span class="cn">TRUE</span> )</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>Proporcion_Juntos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ratio estimator: svyratio.survey.design2(~Juntos, ~Total, diseno, deff = TRUE)
Ratios=
           Total
Juntos 0.3584906
SEs=
             Total
Juntos 0.009556913</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>df_ratio_Juntos <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Proporcion_Juntos[[<span class="dv">1</span>]])</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>df_SE_Juntos    <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="fu">sqrt</span>(Proporcion_Juntos[[<span class="dv">2</span>]]))</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>CV_Juntos       <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">cv</span>(Proporcion_Juntos)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>df_IC_Juntos    <span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">confint</span>(Proporcion_Juntos))</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>df_proporcion_Juntos <span class="ot">&lt;-</span> <span class="fu">cbind</span>(df_ratio_Juntos, df_SE_Juntos,df_IC_Juntos)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>df_proporcion_Juntos<span class="sc">$</span>CV  <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span>CV_Juntos[<span class="dv">1</span>,<span class="dv">1</span>] </span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>df_proporcion_Juntos<span class="sc">$</span>deff  <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">deff</span>(Proporcion_Juntos) </span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_proporcion_Juntos) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Proporción"</span>, <span class="st">"Error Estándar (SE)"</span>, <span class="st">"IC Inferior"</span>, <span class="st">"IC Superior"</span>, <span class="st">"Coeficiente de Variación (CV)"</span>, <span class="st">"Diseño Efectivo (Deff)"</span>)</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>df_proporcion_Juntos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Proporción Error Estándar (SE) IC Inferior IC Superior
Juntos  0.3584906         0.009556913   0.3397594   0.3772218
       Coeficiente de Variación (CV) Diseño Efectivo (Deff)
Juntos                      2.665876              0.7138824</code></pre>
</div>
</div>
<section id="estrategia-2-madow-en-cada-estrato-con-probabilidad-de-selección-proporcional-a-la-cantidad-de-mesas-electorales-del-colegio-ordenando-los-estratos-por-jurisdicción-sección-y-idcircuito." class="level3">
<h3 class="anchored" data-anchor-id="estrategia-2-madow-en-cada-estrato-con-probabilidad-de-selección-proporcional-a-la-cantidad-de-mesas-electorales-del-colegio-ordenando-los-estratos-por-jurisdicción-sección-y-idcircuito.">ESTRATEGIA 2: Madow en cada estrato, con probabilidad de selección proporcional a la cantidad de mesas electorales del colegio, ordenando los estratos por jurisdicción, Sección y IdCircuito.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Datos para generar probabilidad de selección</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>N_mesas<span class="ot">&lt;-</span> tabla_votos_mesa <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(estrato,Distrito, IdSeccion,IdCircuito,Establecimiento) <span class="sc">%&gt;%</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">summarise</span>(<span class="at">N_mesas =</span> <span class="fu">n</span>())</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>tabla_votos_establecimiento<span class="ot">&lt;-</span>tabla_votos_establecimiento <span class="sc">%&gt;%</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(N_mesas, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"estrato"</span>, <span class="st">"Distrito"</span>,<span class="st">"IdSeccion"</span>,<span class="st">"IdCircuito"</span>, <span class="st">"Establecimiento"</span>))</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>tabla_votos_establecimiento<span class="ot">&lt;-</span><span class="fu">merge</span>(tabla_votos_establecimiento, tabla_estratos_final[, <span class="fu">c</span>(<span class="st">"estrato"</span>, <span class="st">"n_prop"</span>, <span class="st">"TotalMesas"</span>)],<span class="at">by=</span><span class="st">"estrato"</span>)</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Genero probabilidad de seleccion de cada establecimiento</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>tabla_votos_establecimiento<span class="sc">$</span>pi_i <span class="ot">&lt;-</span> tabla_votos_establecimiento<span class="sc">$</span>n_prop<span class="sc">*</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>  tabla_votos_establecimiento<span class="sc">$</span>N_mesas<span class="sc">/</span>tabla_votos_establecimiento<span class="sc">$</span>TotalMesas</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Controlo</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(tabla_votos_establecimiento<span class="sc">$</span>pi_i)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 401</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordenamos el marco de muestreo </span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>tabla_votos_establecimiento <span class="ot">&lt;-</span> tabla_votos_establecimiento[<span class="fu">order</span>(tabla_votos_establecimiento<span class="sc">$</span>estrato,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>                                                                 tabla_votos_establecimiento<span class="sc">$</span>Distrito,</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>                                                                 tabla_votos_establecimiento<span class="sc">$</span>IdSeccion,</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>                                                                 tabla_votos_establecimiento<span class="sc">$</span>IdCircuito),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecciono la muestra</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>smplMadow <span class="ot">=</span> sampling<span class="sc">::</span><span class="fu">strata</span>(tabla_votos_establecimiento, <span class="at">stratanames =</span> <span class="fu">c</span>(<span class="st">"estrato"</span>) , </span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">size=</span>tabla_estratos_final<span class="sc">$</span>n_prop , <span class="at">description=</span><span class="cn">TRUE</span>, </span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">method =</span> <span class="st">"systematic"</span>, <span class="at">pik=</span>tabla_votos_establecimiento<span class="sc">$</span>pi_i)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Stratum 1 

Population total and number of selected units: 1021 30 
Stratum 2 

Population total and number of selected units: 3270 89 
Stratum 3 

Population total and number of selected units: 3832 88 
Stratum 4 

Population total and number of selected units: 3757 84 
Stratum 5 

Population total and number of selected units: 2840 59 
Stratum 6 

Population total and number of selected units: 2222 51 
Number of strata  6 
Total number of selected units 401 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recupero datos del marco de muestreo</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>muestra_2 <span class="ot">&lt;-</span> sampling <span class="sc">::</span> <span class="fu">getdata</span>(tabla_votos_establecimiento,smplMadow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculo el factor de expansion utilizando probabilidad de seleccion calculada </span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>muestra_2<span class="sc">$</span>pondera <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>muestra_2<span class="sc">$</span>Prob</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Le indico a survey el diseno de muestra</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="co"># pero supongo muestreo con reposicion (omito fpc)</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>diseno2 <span class="ot">&lt;-</span> survey <span class="sc">::</span> <span class="fu">svydesign</span>(<span class="at">id=</span><span class="sc">~</span><span class="dv">1</span>, <span class="at">strata=</span><span class="sc">~</span>estrato, </span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">weights=</span><span class="sc">~</span>pondera,  <span class="at">data=</span>muestra_2)</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>diseno2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Stratified Independent Sampling design (with replacement)
survey::svydesign(id = ~1, strata = ~estrato, weights = ~pondera, 
    data = muestra_2)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Estimaciones de totales</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="co"># FdT</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>EstimTotalFdT2 <span class="ot">&lt;-</span> survey <span class="sc">::</span> <span class="fu">svytotal</span>(<span class="sc">~</span>FdT, diseno2, <span class="at">deff=</span><span class="cn">TRUE</span>, <span class="at">cv=</span><span class="cn">TRUE</span> )</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>EstimTotalFdT2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      total      SE   DEff
FdT 7215957  164430 0.3203</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cv</span>(EstimTotalFdT2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         FdT
FdT 0.022787</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">deff</span>(EstimTotalFdT2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      FdT 
0.3203052 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(EstimTotalFdT2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      2.5 %  97.5 %
FdT 6893680 7538234</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># FIT</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>EstimTotalFIT2 <span class="ot">&lt;-</span> survey <span class="sc">::</span> <span class="fu">svytotal</span>(<span class="sc">~</span>FIT, diseno2, <span class="at">deff=</span><span class="cn">TRUE</span>, <span class="at">cv=</span><span class="cn">TRUE</span> )</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>EstimTotalFIT2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      total      SE   DEff
FIT 1220107   46826 0.4422</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cv</span>(EstimTotalFIT2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          FIT
FIT 0.0383784</code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">deff</span>(EstimTotalFIT2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      FIT 
0.4421807 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(EstimTotalFIT2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      2.5 %  97.5 %
FIT 1128330 1311883</code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Juntos</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>EstimTotalJuntos2 <span class="ot">&lt;-</span> survey <span class="sc">::</span> <span class="fu">svytotal</span>(<span class="sc">~</span>Juntos, diseno2, <span class="at">deff=</span><span class="cn">TRUE</span>, <span class="at">cv=</span><span class="cn">TRUE</span> )</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>EstimTotalJuntos2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         total      SE   DEff
Juntos 7975641  198821 0.2907</code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cv</span>(EstimTotalJuntos2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Juntos
Juntos 0.02492852</code></pre>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">deff</span>(EstimTotalJuntos2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Juntos 
0.2907448 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(EstimTotalJuntos2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         2.5 %  97.5 %
Juntos 7585959 8365323</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Dataframe de totales</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="co">#FdT</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer el total y el error estándar</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>total <span class="ot">&lt;-</span> <span class="fu">coef</span>(EstimTotalFdT2)  <span class="co"># Estimación del total</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">SE</span>(EstimTotalFdT2)       <span class="co"># Error estándar</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer coeficiente de variación y diseño efectivo</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>cv_val <span class="ot">&lt;-</span> <span class="fu">cv</span>(EstimTotalFdT2)   <span class="co"># Coeficiente de variación</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>deff_val <span class="ot">&lt;-</span> <span class="fu">deff</span>(EstimTotalFdT2)  <span class="co"># Diseño efectivo</span></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer el intervalo de confianza</span></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>conf <span class="ot">&lt;-</span> <span class="fu">confint</span>(EstimTotalFdT2)  <span class="co"># Intervalo de confianza</span></span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un data.frame con los resultados</span></span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a>resultados_totalesFdT2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Total =</span> total,</span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">SE =</span> se,</span>
<span id="cb117-18"><a href="#cb117-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">CV =</span> cv_val,</span>
<span id="cb117-19"><a href="#cb117-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">Deff =</span> deff_val,</span>
<span id="cb117-20"><a href="#cb117-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_Lower =</span> conf[, <span class="dv">1</span>],  <span class="co"># Límite inferior del intervalo de confianza</span></span>
<span id="cb117-21"><a href="#cb117-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_Upper =</span> conf[, <span class="dv">2</span>]   <span class="co"># Límite superior del intervalo de confianza</span></span>
<span id="cb117-22"><a href="#cb117-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb117-23"><a href="#cb117-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-24"><a href="#cb117-24" aria-hidden="true" tabindex="-1"></a><span class="co">#FIT</span></span>
<span id="cb117-25"><a href="#cb117-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer el total y el error estándar</span></span>
<span id="cb117-26"><a href="#cb117-26" aria-hidden="true" tabindex="-1"></a>total <span class="ot">&lt;-</span> <span class="fu">coef</span>(EstimTotalFIT2)  <span class="co"># Estimación del total</span></span>
<span id="cb117-27"><a href="#cb117-27" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">SE</span>(EstimTotalFIT2)       <span class="co"># Error estándar</span></span>
<span id="cb117-28"><a href="#cb117-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-29"><a href="#cb117-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer coeficiente de variación y diseño efectivo</span></span>
<span id="cb117-30"><a href="#cb117-30" aria-hidden="true" tabindex="-1"></a>cv_val <span class="ot">&lt;-</span> <span class="fu">cv</span>(EstimTotalFIT2)   <span class="co"># Coeficiente de variación</span></span>
<span id="cb117-31"><a href="#cb117-31" aria-hidden="true" tabindex="-1"></a>deff_val <span class="ot">&lt;-</span> <span class="fu">deff</span>(EstimTotalFIT2)  <span class="co"># Diseño efectivo</span></span>
<span id="cb117-32"><a href="#cb117-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-33"><a href="#cb117-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer el intervalo de confianza</span></span>
<span id="cb117-34"><a href="#cb117-34" aria-hidden="true" tabindex="-1"></a>conf <span class="ot">&lt;-</span> <span class="fu">confint</span>(EstimTotalFIT2)  <span class="co"># Intervalo de confianza</span></span>
<span id="cb117-35"><a href="#cb117-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-36"><a href="#cb117-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un data.frame con los resultados</span></span>
<span id="cb117-37"><a href="#cb117-37" aria-hidden="true" tabindex="-1"></a>resultados_totalesFIT2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb117-38"><a href="#cb117-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">Total =</span> total,</span>
<span id="cb117-39"><a href="#cb117-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">SE =</span> se,</span>
<span id="cb117-40"><a href="#cb117-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">CV =</span> cv_val,</span>
<span id="cb117-41"><a href="#cb117-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">Deff =</span> deff_val,</span>
<span id="cb117-42"><a href="#cb117-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_Lower =</span> conf[, <span class="dv">1</span>],  <span class="co"># Límite inferior del intervalo de confianza</span></span>
<span id="cb117-43"><a href="#cb117-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_Upper =</span> conf[, <span class="dv">2</span>]   <span class="co"># Límite superior del intervalo de confianza</span></span>
<span id="cb117-44"><a href="#cb117-44" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb117-45"><a href="#cb117-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-46"><a href="#cb117-46" aria-hidden="true" tabindex="-1"></a><span class="co">#Juntos</span></span>
<span id="cb117-47"><a href="#cb117-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer el total y el error estándar</span></span>
<span id="cb117-48"><a href="#cb117-48" aria-hidden="true" tabindex="-1"></a>total <span class="ot">&lt;-</span> <span class="fu">coef</span>(EstimTotalJuntos2)  <span class="co"># Estimación del total</span></span>
<span id="cb117-49"><a href="#cb117-49" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">SE</span>(EstimTotalJuntos2)       <span class="co"># Error estándar</span></span>
<span id="cb117-50"><a href="#cb117-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-51"><a href="#cb117-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer coeficiente de variación y diseño efectivo</span></span>
<span id="cb117-52"><a href="#cb117-52" aria-hidden="true" tabindex="-1"></a>cv_val <span class="ot">&lt;-</span> <span class="fu">cv</span>(EstimTotalJuntos2)   <span class="co"># Coeficiente de variación</span></span>
<span id="cb117-53"><a href="#cb117-53" aria-hidden="true" tabindex="-1"></a>deff_val <span class="ot">&lt;-</span> <span class="fu">deff</span>(EstimTotalJuntos2)  <span class="co"># Diseño efectivo</span></span>
<span id="cb117-54"><a href="#cb117-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-55"><a href="#cb117-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer el intervalo de confianza</span></span>
<span id="cb117-56"><a href="#cb117-56" aria-hidden="true" tabindex="-1"></a>conf <span class="ot">&lt;-</span> <span class="fu">confint</span>(EstimTotalJuntos2)  <span class="co"># Intervalo de confianza</span></span>
<span id="cb117-57"><a href="#cb117-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-58"><a href="#cb117-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un data.frame con los resultados</span></span>
<span id="cb117-59"><a href="#cb117-59" aria-hidden="true" tabindex="-1"></a>resultados_totalesJuntos2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb117-60"><a href="#cb117-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">Total =</span> total,</span>
<span id="cb117-61"><a href="#cb117-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">SE =</span> se,</span>
<span id="cb117-62"><a href="#cb117-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">CV =</span> cv_val,</span>
<span id="cb117-63"><a href="#cb117-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">Deff =</span> deff_val,</span>
<span id="cb117-64"><a href="#cb117-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_Lower =</span> conf[, <span class="dv">1</span>],  <span class="co"># Límite inferior del intervalo de confianza</span></span>
<span id="cb117-65"><a href="#cb117-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">IC_Upper =</span> conf[, <span class="dv">2</span>]   <span class="co"># Límite superior del intervalo de confianza</span></span>
<span id="cb117-66"><a href="#cb117-66" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb117-67"><a href="#cb117-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-68"><a href="#cb117-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-69"><a href="#cb117-69" aria-hidden="true" tabindex="-1"></a><span class="co">#Renombrar columnas</span></span>
<span id="cb117-70"><a href="#cb117-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-71"><a href="#cb117-71" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(resultados_totalesFdT2) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb117-72"><a href="#cb117-72" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Total"</span>,</span>
<span id="cb117-73"><a href="#cb117-73" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Error Estándar (SE)"</span>,</span>
<span id="cb117-74"><a href="#cb117-74" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Coeficiente de Variación (CV)"</span>,</span>
<span id="cb117-75"><a href="#cb117-75" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Diseño Efectivo (Deff)"</span>,</span>
<span id="cb117-76"><a href="#cb117-76" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IC Inferior"</span>,</span>
<span id="cb117-77"><a href="#cb117-77" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IC Superior"</span></span>
<span id="cb117-78"><a href="#cb117-78" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb117-79"><a href="#cb117-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Ver los resultados</span></span>
<span id="cb117-80"><a href="#cb117-80" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resultados_totalesFdT2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Total Error Estándar (SE) Coeficiente de Variación (CV)
FdT 7215957              164430                      0.022787
    Diseño Efectivo (Deff) IC Inferior IC Superior
FdT              0.3203052     6893680     7538234</code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(resultados_totalesFIT2) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Total"</span>,</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Error Estándar (SE)"</span>,</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Coeficiente de Variación (CV)"</span>,</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Diseño Efectivo (Deff)"</span>,</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IC Inferior"</span>,</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IC Superior"</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Ver los resultados</span></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resultados_totalesFIT2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Total Error Estándar (SE) Coeficiente de Variación (CV)
FIT 1220107            46825.74                     0.0383784
    Diseño Efectivo (Deff) IC Inferior IC Superior
FIT              0.4421807     1128330     1311883</code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(resultados_totalesJuntos2) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Total"</span>,</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Error Estándar (SE)"</span>,</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Coeficiente de Variación (CV)"</span>,</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Diseño Efectivo (Deff)"</span>,</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IC Inferior"</span>,</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IC Superior"</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Ver los resultados</span></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resultados_totalesJuntos2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Total Error Estándar (SE) Coeficiente de Variación (CV)
Juntos 7975641            198820.9                    0.02492852
       Diseño Efectivo (Deff) IC Inferior IC Superior
Juntos              0.2907448     7585959     8365323</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Estimaciones de proporciones</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="co"># FdT</span></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>Proporcion_FdT2 <span class="ot">&lt;-</span> survey <span class="sc">::</span> <span class="fu">svyratio</span>(<span class="sc">~</span>FdT , <span class="sc">~</span>Total, diseno2, <span class="at">deff=</span><span class="cn">TRUE</span> )</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>Proporcion_FdT2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ratio estimator: svyratio.survey.design2(~FdT, ~Total, diseno2, deff = TRUE)
Ratios=
        Total
FdT 0.3120908
SEs=
          Total
FdT 0.006898125</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>df_ratio_FdT2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Proporcion_FdT2[[<span class="dv">1</span>]])</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>df_SE_FdT2    <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="fu">sqrt</span>(Proporcion_FdT2[[<span class="dv">2</span>]]))</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>CV_FdT2     <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">cv</span>(Proporcion_FdT2)</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>df_IC_FdT2    <span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">confint</span>(Proporcion_FdT2))</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>df_proporcion_FdT2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(df_ratio_FdT2, df_SE_FdT2,df_IC_FdT2)</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>df_proporcion_FdT2<span class="sc">$</span>CV_FdT2  <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span>CV_FdT2[<span class="dv">1</span>,<span class="dv">1</span>] </span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>df_proporcion_FdT2<span class="sc">$</span>deff  <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">deff</span>(Proporcion_FdT2) </span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_proporcion_FdT2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Proporción"</span>, <span class="st">"Error Estándar (SE)"</span>, <span class="st">"IC Inferior"</span>, <span class="st">"IC Superior"</span>, <span class="st">"Coeficiente de Variación (CV)"</span>, <span class="st">"Diseño Efectivo (Deff)"</span>)</span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df_proporcion_FdT2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Proporción Error Estándar (SE) IC Inferior IC Superior
FdT  0.3120908         0.006898125   0.2985708   0.3256109
    Coeficiente de Variación (CV) Diseño Efectivo (Deff)
FdT                      2.210294              0.6465105</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># FIT</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>Proporcion_FIT2 <span class="ot">&lt;-</span> survey <span class="sc">::</span> <span class="fu">svyratio</span>(<span class="sc">~</span>FIT , <span class="sc">~</span>Total, diseno2, <span class="at">deff=</span><span class="cn">TRUE</span> )</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>Proporcion_FIT2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ratio estimator: svyratio.survey.design2(~FIT, ~Total, diseno2, deff = TRUE)
Ratios=
         Total
FIT 0.05276973
SEs=
          Total
FIT 0.001987087</code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>df_ratio_FIT2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Proporcion_FIT2[[<span class="dv">1</span>]])</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>df_SE_FIT2    <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="fu">sqrt</span>(Proporcion_FIT2[[<span class="dv">2</span>]]))</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>CV_FIT2       <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">cv</span>(Proporcion_FIT2)</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>df_IC_FIT2    <span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">confint</span>(Proporcion_FIT2))</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>df_proporcion_FIT2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(df_ratio_FIT2, df_SE_FIT2,df_IC_FIT2)</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a>df_proporcion_FIT2<span class="sc">$</span>CV  <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span>CV_FIT2[<span class="dv">1</span>,<span class="dv">1</span>] </span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>df_proporcion_FIT2<span class="sc">$</span>deff  <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">deff</span>(Proporcion_FIT2) </span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_proporcion_FIT2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Proporción"</span>, <span class="st">"Error Estándar (SE)"</span>, <span class="st">"IC Inferior"</span>, <span class="st">"IC Superior"</span>, <span class="st">"Coeficiente de Variación (CV)"</span>, <span class="st">"Diseño Efectivo (Deff)"</span>)</span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df_proporcion_FIT2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Proporción Error Estándar (SE) IC Inferior IC Superior
FIT 0.05276973         0.001987087  0.04887511  0.05666435
    Coeficiente de Variación (CV) Diseño Efectivo (Deff)
FIT                      3.765582               0.656613</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Juntos</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>Proporcion_Juntos2 <span class="ot">&lt;-</span> survey <span class="sc">::</span> <span class="fu">svyratio</span>(<span class="sc">~</span>Juntos , <span class="sc">~</span>Total, diseno2, <span class="at">deff=</span><span class="cn">TRUE</span> )</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>Proporcion_Juntos2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ratio estimator: svyratio.survey.design2(~Juntos, ~Total, diseno2, deff = TRUE)
Ratios=
           Total
Juntos 0.3449472
SEs=
             Total
Juntos 0.008030008</code></pre>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>df_ratio_Juntos2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Proporcion_Juntos2[[<span class="dv">1</span>]])</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>df_SE_Juntos2    <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="fu">sqrt</span>(Proporcion_Juntos2[[<span class="dv">2</span>]]))</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>CV_Juntos2       <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">cv</span>(Proporcion_Juntos2)</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>df_IC_Juntos2    <span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">confint</span>(Proporcion_Juntos2))</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>df_proporcion_Juntos2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(df_ratio_Juntos2, df_SE_Juntos2,df_IC_Juntos2)</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>df_proporcion_Juntos2<span class="sc">$</span>CV  <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">*</span>CV_Juntos2[<span class="dv">1</span>,<span class="dv">1</span>] </span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>df_proporcion_Juntos2<span class="sc">$</span>deff  <span class="ot">&lt;-</span> survey<span class="sc">::</span><span class="fu">deff</span>(Proporcion_Juntos2) </span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_proporcion_Juntos2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Proporción"</span>, <span class="st">"Error Estándar (SE)"</span>, <span class="st">"IC Inferior"</span>, <span class="st">"IC Superior"</span>, <span class="st">"Coeficiente de Variación (CV)"</span>, <span class="st">"Diseño Efectivo (Deff)"</span>)</span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df_proporcion_Juntos2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Proporción Error Estándar (SE) IC Inferior IC Superior
Juntos  0.3449472         0.008030008   0.3292087   0.3606858
       Coeficiente de Variación (CV) Diseño Efectivo (Deff)
Juntos                      2.327895              0.4620637</code></pre>
</div>
</div>
</section>
</section>
<section id="presentar-en-un-cuadro-y-gráfico-los-resultados" class="level2">
<h2 class="anchored" data-anchor-id="presentar-en-un-cuadro-y-gráfico-los-resultados">9. Presentar en un cuadro y gráfico los resultados</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Unifico df de estimación de totales 1ra estrategia</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>resultados_totales1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(resultados_totalesFdT, resultados_totalesFIT, resultados_totalesJuntos)</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Unifico df de estimación de totales 2da estrategia</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>resultados_totales2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(resultados_totalesFdT2, resultados_totalesFIT2, resultados_totalesJuntos)</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Unifico ambos</span></span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar una columna de identificación</span></span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>resultados_totales1<span class="sc">$</span>estrategia <span class="ot">&lt;-</span> <span class="st">"MAS"</span></span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>resultados_totales2<span class="sc">$</span>estrategia <span class="ot">&lt;-</span> <span class="st">"MADOW"</span></span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>resultados_totales <span class="ot">&lt;-</span> <span class="fu">rbind</span>(resultados_totales1, resultados_totales2)</span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>resultados_totales <span class="ot">&lt;-</span> <span class="fu">rownames_to_column</span>(resultados_totales, <span class="at">var =</span> <span class="st">"Partido"</span>)</span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-16"><a href="#cb135-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Unifico df de estimación de proporción 1ra estrategia</span></span>
<span id="cb135-17"><a href="#cb135-17" aria-hidden="true" tabindex="-1"></a>df_proporcion1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_proporcion_FdT, df_proporcion_FIT, df_proporcion_Juntos)</span>
<span id="cb135-18"><a href="#cb135-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-19"><a href="#cb135-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Unifico df de estimación de proporción 2da estrategia</span></span>
<span id="cb135-20"><a href="#cb135-20" aria-hidden="true" tabindex="-1"></a>df_proporcion2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_proporcion_FdT2, df_proporcion_FIT2, df_proporcion_Juntos2)</span>
<span id="cb135-21"><a href="#cb135-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-22"><a href="#cb135-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Unifico ambos</span></span>
<span id="cb135-23"><a href="#cb135-23" aria-hidden="true" tabindex="-1"></a>df_proporcion1<span class="sc">$</span>estrategia <span class="ot">&lt;-</span> <span class="st">"MAS"</span></span>
<span id="cb135-24"><a href="#cb135-24" aria-hidden="true" tabindex="-1"></a>df_proporcion2<span class="sc">$</span>estrategia <span class="ot">&lt;-</span> <span class="st">"MADOW"</span></span>
<span id="cb135-25"><a href="#cb135-25" aria-hidden="true" tabindex="-1"></a>df_proporcion <span class="ot">&lt;-</span> <span class="fu">rbind</span>(df_proporcion1, df_proporcion2)</span>
<span id="cb135-26"><a href="#cb135-26" aria-hidden="true" tabindex="-1"></a>df_proporcion <span class="ot">&lt;-</span> <span class="fu">rownames_to_column</span>(df_proporcion, <span class="at">var =</span> <span class="st">"Partido"</span>)</span>
<span id="cb135-27"><a href="#cb135-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-28"><a href="#cb135-28" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resultados_totales)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Partido   Total Error Estándar (SE) Coeficiente de Variación (CV)
1     FdT 7296278           256585.05                    0.03516657
2     FIT 1163874            56025.50                    0.04813710
3  Juntos 8259274           311851.95                    0.03775779
4    FdT1 7215957           164430.03                    0.02278700
5    FIT1 1220107            46825.74                    0.03837840
6 Juntos1 8259274           311851.95                    0.03775779
  Diseño Efectivo (Deff) IC Inferior IC Superior estrategia
1              0.8648998     6793380     7799175        MAS
2              0.7577440     1054066     1273682        MAS
3              0.7791112     7648055     8870492        MAS
4              0.3203052     6893680     7538234      MADOW
5              0.4421807     1128330     1311883      MADOW
6              0.7791112     7648055     8870492      MADOW</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(df_proporcion)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Partido Proporción Error Estándar (SE) IC Inferior IC Superior
1     FdT 0.31669212         0.008003004  0.30100652  0.33237772
2     FIT 0.05051749         0.002111681  0.04637867  0.05465631
3  Juntos 0.35849058         0.009556913  0.33975938  0.37722179
4    FdT1 0.31209083         0.006898125  0.29857076  0.32561091
5    FIT1 0.05276973         0.001987087  0.04887511  0.05666435
6 Juntos1 0.34494723         0.008030008  0.32920870  0.36068576
  Coeficiente de Variación (CV) Diseño Efectivo (Deff) estrategia
1                      2.527061              0.8552909        MAS
2                      4.180098              0.8201744        MAS
3                      2.665876              0.7138824        MAS
4                      2.210294              0.6465105      MADOW
5                      3.765582              0.6566130      MADOW
6                      2.327895              0.4620637      MADOW</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear el gráfico</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordenar manualmente los partidos</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(resultados_totales, <span class="fu">aes</span>(<span class="at">x =</span> Partido, <span class="at">y =</span> Total)) <span class="sc">+</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"skyblue"</span>, <span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span>  <span class="co"># Barras</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="st">`</span><span class="at">IC Inferior</span><span class="st">`</span>, <span class="at">ymax =</span> <span class="st">`</span><span class="at">IC Superior</span><span class="st">`</span>), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">"FdT"</span>, <span class="st">"Juntos"</span>, <span class="st">"FIT"</span>, <span class="st">"FdT1"</span>, <span class="st">"Juntos1"</span>, <span class="st">"FIT1"</span>)) <span class="sc">+</span> </span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Partido"</span>, <span class="at">y =</span> <span class="st">"Total"</span>, <span class="at">title =</span> <span class="st">"Totales y Intervalos de Confianza"</span>) <span class="sc">+</span></span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TP2_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_proporcion, <span class="fu">aes</span>(<span class="at">x =</span> Partido, <span class="at">y =</span> Proporción)) <span class="sc">+</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"skyblue"</span>, <span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span>  <span class="co"># Barras</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="st">`</span><span class="at">IC Inferior</span><span class="st">`</span>, <span class="at">ymax =</span> <span class="st">`</span><span class="at">IC Superior</span><span class="st">`</span>), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">"FdT"</span>, <span class="st">"Juntos"</span>, <span class="st">"FIT"</span>, <span class="st">"FdT1"</span>, <span class="st">"Juntos1"</span>, <span class="st">"FIT1"</span>))<span class="sc">+</span></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Partido"</span>, <span class="at">y =</span> <span class="st">"Proporción"</span>, <span class="at">title =</span> <span class="st">"Proporciones e Intervalos de Confianza"</span>) <span class="sc">+</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TP2_files/figure-html/unnamed-chunk-35-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(resultados_totales, <span class="fu">aes</span>(<span class="at">x =</span> Partido, <span class="at">ymin =</span> <span class="st">`</span><span class="at">IC Inferior</span><span class="st">`</span>, <span class="at">ymax =</span> <span class="st">`</span><span class="at">IC Superior</span><span class="st">`</span>, <span class="at">color =</span> Partido)) <span class="sc">+</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">linewidth =</span> <span class="fl">1.5</span>, <span class="at">width =</span> <span class="fl">0.4</span>) <span class="sc">+</span>  <span class="co"># Líneas de error más gruesas</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Partido"</span>, <span class="at">y =</span> <span class="st">"Intervalo de Confianza"</span>, <span class="at">title =</span> <span class="st">"Intervalos de Confianza de los Partidos"</span>) <span class="sc">+</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">"FdT"</span>, <span class="st">"Juntos"</span>, <span class="st">"FIT"</span>, <span class="st">"FdT1"</span>, <span class="st">"Juntos1"</span>, <span class="st">"FIT1"</span>))<span class="sc">+</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>( <span class="co">#axis.text.x = element_text(angle = 45, hjust = 1),</span></span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.position =</span> <span class="st">"none"</span>)  <span class="co"># Rotar las etiquetas del eje X si es necesario</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TP2_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_proporcion, <span class="fu">aes</span>(<span class="at">x =</span> Partido, <span class="at">ymin =</span> <span class="st">`</span><span class="at">IC Inferior</span><span class="st">`</span>, <span class="at">ymax =</span> <span class="st">`</span><span class="at">IC Superior</span><span class="st">`</span>, <span class="at">color =</span> Partido)) <span class="sc">+</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">linewidth =</span> <span class="fl">1.5</span>, <span class="at">width =</span> <span class="fl">0.4</span>) <span class="sc">+</span>  <span class="co"># Líneas de error más gruesas</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Partido"</span>, <span class="at">y =</span> <span class="st">"Intervalo de Confianza"</span>, <span class="at">title =</span> <span class="st">"Intervalos de Confianza de los Partidos"</span>) <span class="sc">+</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">"FdT"</span>, <span class="st">"Juntos"</span>, <span class="st">"FIT"</span>, <span class="st">"FdT1"</span>, <span class="st">"Juntos1"</span>, <span class="st">"FIT1"</span>)) <span class="sc">+</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>( <span class="co">#axis.text.x = element_text(angle = 45, hjust = 1), </span></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>)  <span class="co"># Rotar las etiquetas del eje X si es necesario</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="TP2_files/figure-html/unnamed-chunk-36-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="con-alguna-de-las-dos-estrategias-se-puede-determinar-con-un-95-de-confianza-quien-sacó-más-votos" class="level2">
<h2 class="anchored" data-anchor-id="con-alguna-de-las-dos-estrategias-se-puede-determinar-con-un-95-de-confianza-quien-sacó-más-votos">10. Con alguna de las dos estrategias se puede determinar con un 95% de confianza quien sacó más votos?</h2>
<p>Comparación de intervalos:</p>
<p>En la primera estrategia si bien las proporciones que sacaron los candidatos son diferentes los intervalos de confianza se superponen, es decir que el límite superior del frente de todos está dentro del intervalo de juntos por el cambio, por lo que no puede afirmarse que un partido sacó más votos que el otro. Por el contrario con la segunda estrategia de muestreo los IC no se solapan, el límite inferior de Juntos es mayor que el límite superior del frente de todos, de forma que podría afirmarse con un 95% de confianza que Juntos por el cambio sacó más votos en la elección.</p>
<p>De igual manera el valor del DEFF en la segunda estrategia es menor demostrando que es una mejor opción para la selección de los casos al reducir la varianza de la estimación.</p>
</section>
</section>
<section id="ejercicio-2" class="level1">
<h1>Ejercicio 2</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creación de dataframe</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>zona<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>)</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>hogares_marco<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">25000</span>,<span class="dv">65000</span>,<span class="dv">20000</span>)</span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>hogares_encuestados<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">200</span>,<span class="dv">150</span>,<span class="dv">250</span>)</span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>hogares_pobres_muestra<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">70</span>,<span class="dv">80</span>,<span class="dv">22</span>)</span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>poblacion_pobre_encuestada<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">260</span>,<span class="dv">400</span>,<span class="dv">60</span>)</span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>poblacion_encuestada<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">820</span>,<span class="dv">700</span>,<span class="dv">600</span>)</span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a>tabla_datos<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(zona,hogares_marco,hogares_encuestados,hogares_pobres_muestra,poblacion_pobre_encuestada,poblacion_encuestada))</span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a><span class="co">#str(tabla_datos)</span></span>
<span id="cb143-12"><a href="#cb143-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-13"><a href="#cb143-13" aria-hidden="true" tabindex="-1"></a>tabla_datos <span class="ot">&lt;-</span> tabla_datos <span class="sc">%&gt;%</span></span>
<span id="cb143-14"><a href="#cb143-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span><span class="dv">1</span>, as.numeric))</span>
<span id="cb143-15"><a href="#cb143-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-16"><a href="#cb143-16" aria-hidden="true" tabindex="-1"></a>tabla_datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  zona hogares_marco hogares_encuestados hogares_pobres_muestra
1    A         25000                 200                     70
2    B         65000                 150                     80
3    C         20000                 250                     22
  poblacion_pobre_encuestada poblacion_encuestada
1                        260                  820
2                        400                  700
3                         60                  600</code></pre>
</div>
</div>
<section id="presentar-en-una-tabla-o-gráfico-la-proporción-de-hogares-pobres-por-zona" class="level2">
<h2 class="anchored" data-anchor-id="presentar-en-una-tabla-o-gráfico-la-proporción-de-hogares-pobres-por-zona">1. Presentar en una tabla o gráfico la proporción de hogares pobres por zona</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>tabla_datos<span class="ot">&lt;-</span>tabla_datos <span class="sc">%&gt;%</span> </span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ph_hogares=</span>hogares_pobres_muestra<span class="sc">/</span>hogares_encuestados,</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ph_poblacion=</span>poblacion_pobre_encuestada<span class="sc">/</span>poblacion_encuestada)</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tabla_datos[, <span class="fu">c</span>(<span class="st">"zona"</span>, <span class="st">"ph_hogares"</span>,<span class="st">"ph_poblacion"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  zona ph_hogares ph_poblacion
1    A  0.3500000    0.3170732
2    B  0.5333333    0.5714286
3    C  0.0880000    0.1000000</code></pre>
</div>
</div>
</section>
<section id="hallar-el-factor-de-expansión-de-cada-hogar-de-la-muestra-y-de-cada-persona-encuestada" class="level2">
<h2 class="anchored" data-anchor-id="hallar-el-factor-de-expansión-de-cada-hogar-de-la-muestra-y-de-cada-persona-encuestada">2. Hallar el factor de expansión de cada hogar de la muestra y de cada persona encuestada</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>tabla_datos<span class="ot">&lt;-</span>tabla_datos <span class="sc">%&gt;%</span> </span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">F_hogar=</span>hogares_marco<span class="sc">/</span>hogares_encuestados,</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">F_persona=</span>hogares_marco<span class="sc">/</span>hogares_encuestados)</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>tabla_datos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  zona hogares_marco hogares_encuestados hogares_pobres_muestra
1    A         25000                 200                     70
2    B         65000                 150                     80
3    C         20000                 250                     22
  poblacion_pobre_encuestada poblacion_encuestada ph_hogares ph_poblacion
1                        260                  820  0.3500000    0.3170732
2                        400                  700  0.5333333    0.5714286
3                         60                  600  0.0880000    0.1000000
   F_hogar F_persona
1 125.0000  125.0000
2 433.3333  433.3333
3  80.0000   80.0000</code></pre>
</div>
</div>
<p>Como todas las personas del hogar son encuestadas, la probabilidad de selección de una persona es igual a la del hogar y por tanto el factor de expansión, que es la inversa de la probabilidad de selección, también lo será.</p>
</section>
<section id="las-tres-zonas-presentan-un-perfil-diferencial-en-términos-de-pobreza" class="level2">
<h2 class="anchored" data-anchor-id="las-tres-zonas-presentan-un-perfil-diferencial-en-términos-de-pobreza">3. Las tres zonas presentan un perfil diferencial en términos de pobreza?</h2>
<p>Si se observan las estimaciones muestrales puede observarse que la zona B presenta una proporción de hogares pobres mucho mayor que los demás estratos, lo mismo sucede con la proporción de las personas pobres. Sin embargo, para afirmar que existen diferencias entre los estratos hay que analizar los intervalos de confianza para cada estimación, si los mismos no se solapan puede afirmarse, con el nivel de confianza definido, que las estimaciones de pobreza difieren entre los estratos, pudiendo determinarse el estrato con mayor y menor pobreza. Dicho procedimiento se realiza en el punto n°4.</p>
</section>
<section id="estimar-con-la-muestra-seleccionada-el-total-de-hogares-pobres-y-la-proporción-de-hogares-pobres-el-cv-y-deff-correspondientes.-dar-un-ic90-para-cada-estimación." class="level2">
<h2 class="anchored" data-anchor-id="estimar-con-la-muestra-seleccionada-el-total-de-hogares-pobres-y-la-proporción-de-hogares-pobres-el-cv-y-deff-correspondientes.-dar-un-ic90-para-cada-estimación.">4. Estimar, con la muestra seleccionada, el total de hogares pobres y la proporción de hogares pobres, el CV y deff correspondientes. Dar un IC(90%) para cada estimación.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Estimación </span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="fu">sum</span>(tabla_datos<span class="sc">$</span>hogares_encuestados) <span class="co"># en la consigna dice 700, no son 600 hogares?</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>N<span class="ot">=</span><span class="fu">sum</span>(tabla_datos<span class="sc">$</span>hogares_marco)</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a><span class="co">#peso en cada estrato</span></span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>tabla_datos<span class="ot">&lt;-</span>tabla_datos <span class="sc">%&gt;%</span> </span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wh=</span>hogares_marco<span class="sc">/</span>N)</span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a><span class="co">#peso al cuadrado en cada estrato</span></span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>tabla_datos<span class="ot">&lt;-</span>tabla_datos <span class="sc">%&gt;%</span> </span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wh2=</span>(hogares_marco<span class="sc">/</span>N)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a><span class="co">#s2 en cada estrato</span></span>
<span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a>tabla_datos <span class="ot">&lt;-</span> tabla_datos <span class="sc">%&gt;%</span></span>
<span id="cb149-18"><a href="#cb149-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sh2=</span> ph_hogares <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> ph_hogares) )</span>
<span id="cb149-19"><a href="#cb149-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-20"><a href="#cb149-20" aria-hidden="true" tabindex="-1"></a><span class="co">#varianza en estratos</span></span>
<span id="cb149-21"><a href="#cb149-21" aria-hidden="true" tabindex="-1"></a>tabla_datos <span class="ot">&lt;-</span> tabla_datos <span class="sc">%&gt;%</span></span>
<span id="cb149-22"><a href="#cb149-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">varianza=</span> wh2<span class="sc">*</span>sh2<span class="sc">/</span>hogares_encuestados)</span>
<span id="cb149-23"><a href="#cb149-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-24"><a href="#cb149-24" aria-hidden="true" tabindex="-1"></a><span class="co">#varianza del estimador</span></span>
<span id="cb149-25"><a href="#cb149-25" aria-hidden="true" tabindex="-1"></a>varianza_estimador<span class="ot">=</span><span class="fu">sum</span>(tabla_datos<span class="sc">$</span>varianza)</span>
<span id="cb149-26"><a href="#cb149-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-27"><a href="#cb149-27" aria-hidden="true" tabindex="-1"></a><span class="co">#desvío </span></span>
<span id="cb149-28"><a href="#cb149-28" aria-hidden="true" tabindex="-1"></a>ds<span class="ot">=</span><span class="fu">sqrt</span>(varianza_estimador)</span>
<span id="cb149-29"><a href="#cb149-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-30"><a href="#cb149-30" aria-hidden="true" tabindex="-1"></a><span class="co">#probabilidad en estrato</span></span>
<span id="cb149-31"><a href="#cb149-31" aria-hidden="true" tabindex="-1"></a>tabla_datos <span class="ot">&lt;-</span> tabla_datos <span class="sc">%&gt;%</span></span>
<span id="cb149-32"><a href="#cb149-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ph_wh2=</span> ph_hogares <span class="sc">*</span> wh)</span>
<span id="cb149-33"><a href="#cb149-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-34"><a href="#cb149-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-35"><a href="#cb149-35" aria-hidden="true" tabindex="-1"></a><span class="co">#estimación del total de hogares pobres </span></span>
<span id="cb149-36"><a href="#cb149-36" aria-hidden="true" tabindex="-1"></a>estimacion_total_hogares <span class="ot">&lt;-</span>  <span class="fu">sum</span>(tabla_datos<span class="sc">$</span>ph_wh2 <span class="sc">*</span> N)</span>
<span id="cb149-37"><a href="#cb149-37" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Estimación total hogares pobres: "</span>, estimacion_total_hogares))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Estimación total hogares pobres:  45176.6666666667"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Intervalos de confianza 90%</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>IC_infT <span class="ot">&lt;-</span> estimacion_total_hogares <span class="sc">-</span> <span class="fl">1.64</span> <span class="sc">*</span> ds</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>IC_supT <span class="ot">&lt;-</span> estimacion_total_hogares <span class="sc">+</span> <span class="fl">1.64</span> <span class="sc">*</span> ds</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"IC Inferior Total hogares pobres: "</span>, IC_infT))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "IC Inferior Total hogares pobres:  45176.6248953489"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"IC Superior Total hogares pobres: "</span>, IC_supT))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "IC Superior Total hogares pobres:  45176.7084379844"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co">#estimación de la proporción de hogares pobres </span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>estimacion_proporcion_hogares <span class="ot">&lt;-</span>  <span class="fu">sum</span>(tabla_datos<span class="sc">$</span>ph_wh2 <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Estimación proporción hogares pobres: "</span>, estimacion_proporcion_hogares))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Estimación proporción hogares pobres:  41.069696969697"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>IC_infP <span class="ot">&lt;-</span> estimacion_proporcion_hogares <span class="sc">-</span> <span class="fl">1.64</span> <span class="sc">*</span> ds</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>IC_supP <span class="ot">&lt;-</span> estimacion_proporcion_hogares <span class="sc">+</span> <span class="fl">1.64</span> <span class="sc">*</span> ds</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"IC Inferior Proporción hogares pobres: "</span>, IC_infP))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "IC Inferior Proporción hogares pobres:  41.0279256519759"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"IC Superior Proporción hogares pobres: "</span>, IC_supP))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "IC Superior Proporción hogares pobres:  41.1114682874181"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co">#CV</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>CV_total <span class="ot">&lt;-</span> ds <span class="sc">/</span> estimacion_total_hogares <span class="sc">*</span> <span class="dv">100</span> </span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"CV del total: "</span>, CV_total))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "CV del total:  0.0000563793603267219"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>CV_prop <span class="ot">&lt;-</span> ds <span class="sc">/</span> <span class="fu">sum</span>(tabla_datos<span class="sc">$</span>ph_wh2) <span class="sc">*</span> <span class="dv">100</span> </span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"CV de la proporción: "</span>, CV_prop))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "CV de la proporción:  6.20172963593941"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co">#varianza en MAS (1-n/N)*s2/n (NO ME QUEDA CLARO SI DIVIDO POR n)</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>p_total_hogares<span class="ot">=</span><span class="fu">sum</span>(tabla_datos<span class="sc">$</span>hogares_pobres_muestra)<span class="sc">/</span><span class="fu">sum</span>(tabla_datos<span class="sc">$</span>hogares_encuestados)</span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>s2_total<span class="ot">=</span> p_total_hogares <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p_total_hogares) </span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>var_MAS<span class="ot">=</span>(<span class="dv">1</span><span class="sc">-</span>n<span class="sc">/</span>N)<span class="sc">*</span>s2_total<span class="sc">/</span>n</span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a><span class="co">#DEFF</span></span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a>deff<span class="ot">=</span>varianza_estimador<span class="sc">/</span>var_MAS</span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"DEFF: "</span>, deff))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "DEFF:  1.91392781399597"</code></pre>
</div>
</div>
</section>
<section id="por-qué-siendo-que-las-tres-zonas-son-diferentes-respecto-a-la-variable-bajo-estudio-proporción-de-hogares-pobres-el-deff-es-claramente-mayor-a-1-en-la-estimación-del-total-y-proporción-de-hogares-pobres" class="level2">
<h2 class="anchored" data-anchor-id="por-qué-siendo-que-las-tres-zonas-son-diferentes-respecto-a-la-variable-bajo-estudio-proporción-de-hogares-pobres-el-deff-es-claramente-mayor-a-1-en-la-estimación-del-total-y-proporción-de-hogares-pobres">5. Por qué, siendo que las tres zonas son diferentes respecto a la variable bajo estudio (proporción de hogares pobres), el deff es claramente mayor a 1 en la estimación del total y proporción de hogares pobres?</h2>
<p>Porque la asignación de la cantidad de hogares seleccionado por estrato no se hizo en función de un criterio adecuado, no fue uniforme, ni ponderada ni óptima.De hecho en el estrato donde hay mas hogares en el universo se seleccionan menos hogares en la muestra y viceversa.</p>
</section>
<section id="estimar-el-total-de-personas-pobres-y-la-proporción-de-personas-pobres-recordar-que-población-pobre-es-la-que-habita-en-hogares-pobres.-se-puede-con-los-datos-disponibles-estimar-el-cv-y-deff-de-estas-estimaciones" class="level2">
<h2 class="anchored" data-anchor-id="estimar-el-total-de-personas-pobres-y-la-proporción-de-personas-pobres-recordar-que-población-pobre-es-la-que-habita-en-hogares-pobres.-se-puede-con-los-datos-disponibles-estimar-el-cv-y-deff-de-estas-estimaciones">6. Estimar el total de personas pobres y la proporción de personas pobres (recordar que población pobre es la que habita en hogares pobres). Se puede con los datos disponibles estimar el CV y deff de estas estimaciones?</h2>
</section>
<section id="en-base-a-los-resultados-de-la-encuesta-cómo-debería-haber-sido-la-distribución-de-la-muestra-por-zona-si-el-objetivo-era-estimar-el-total-de-hogares-pobres-en-la-localidad-obtener-la-asignación-de-neyman" class="level2">
<h2 class="anchored" data-anchor-id="en-base-a-los-resultados-de-la-encuesta-cómo-debería-haber-sido-la-distribución-de-la-muestra-por-zona-si-el-objetivo-era-estimar-el-total-de-hogares-pobres-en-la-localidad-obtener-la-asignación-de-neyman">7. En base a los resultados de la encuesta, cómo debería haber sido la distribución de la muestra por zona si el objetivo era estimar el total de hogares pobres en la localidad? (obtener la asignación de Neyman)</h2>
</section>
</section>
<section id="ejercicio-3" class="level1">
<h1>Ejercicio 3</h1>
<p>Seleccionar con sampling una muestra ese diseño y estimar luego con survey la media de Y y el correspondiente CV</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Estrato =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>),  <span class="co"># Estratos</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Unidad =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>,  <span class="co"># Unidades</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> <span class="fu">c</span>(<span class="dv">18</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>)  <span class="co"># Valores de la variable Y</span></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="paso-1-agrego-fpc-pues-selecciono-mas-en-cada-estrato" class="level2">
<h2 class="anchored" data-anchor-id="paso-1-agrego-fpc-pues-selecciono-mas-en-cada-estrato">Paso 1: Agrego fpc pues selecciono MAS en cada estrato</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span>  data <span class="sc">%&gt;%</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Estrato) <span class="sc">%&gt;%</span></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fpc=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="paso-2-selección-de-muestra" class="level2">
<h2 class="anchored" data-anchor-id="paso-2-selección-de-muestra">Paso 2: Selección de muestra</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tamaños de muestra por estrato</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>)  <span class="co"># Estrato 1: 1 unidad, Estrato 2: 1 unidad, Estrato 3: 3 unidades</span></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Selección de la muestra estratificada</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># Para reproducibilidad</span></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a><span class="co">#options(survey.lonely.psu="fail")</span></span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a>muestra <span class="ot">&lt;-</span> sampling<span class="sc">::</span><span class="fu">strata</span>(<span class="at">data =</span> data, <span class="at">stratanames =</span> <span class="st">"Estrato"</span>, <span class="at">size =</span> n, <span class="at">method =</span> <span class="st">"srswor"</span>)  <span class="co"># Sin reemplazo</span></span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraer las unidades seleccionadas</span></span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a>muestra_seleccionada <span class="ot">&lt;-</span> <span class="fu">getdata</span>(data, muestra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="paso-3-diseño-de-encuesta" class="level2">
<h2 class="anchored" data-anchor-id="paso-3-diseño-de-encuesta">Paso 3: Diseño de encuesta</h2>
<p>La opcion <strong>adjust</strong> utiliza la media total para el cálculo de varianza en el estrato con solo una observación</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">survey.lonely.psu=</span><span class="st">"adjust"</span>)</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Crear un diseño estratificado con los pesos correctos</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>,  <span class="co"># Las unidades seleccionadas no tienen subgrupos</span></span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">strata =</span> <span class="sc">~</span>Estrato,  <span class="co"># Estratos</span></span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> muestra_seleccionada,</span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">/</span> Prob,  <span class="co"># Pesos: inverso de la probabilidad de selección</span></span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">fpc =</span> <span class="sc">~</span> fpc</span>
<span id="cb170-11"><a href="#cb170-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="paso-4-cálculo-de-estimaciones" class="level2">
<h2 class="anchored" data-anchor-id="paso-4-cálculo-de-estimaciones">Paso 4: Cálculo de estimaciones</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimar la media de Y</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>media_Y <span class="ot">&lt;-</span> <span class="fu">svymean</span>(<span class="sc">~</span>Y, design)</span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Media estimada de Y:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Media estimada de Y:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(media_Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    mean     SE
Y 9.3636 0.4616</code></pre>
</div>
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcular el coeficiente de variación (CV) de la media</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>cv_Y <span class="ot">&lt;-</span> <span class="fu">cv</span>(media_Y)</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Coeficiente de variación (CV) de la media:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Coeficiente de variación (CV) de la media:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cv_Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Y
Y 0.04929865</code></pre>
</div>
</div>
</section>
</section>
<section id="ejercicio-4" class="level1">
<h1>Ejercicio 4</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>Deptos2022 <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"data/tabla_deptos_2022.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="estratificación-tamaño-de-muestra-y-asignación" class="level3">
<h3 class="anchored" data-anchor-id="estratificación-tamaño-de-muestra-y-asignación">1. Estratificación, tamaño de muestra y asignación</h3>
<p>Utilizaremos el comando strata.LH del paquete stratification para conseguir la ‘mejor’ estratificación, tamaño de muestra y asignación, indicando un alloc = c(0.5,0.5,0)).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>Estratificacion <span class="ot">&lt;-</span> <span class="fu">strata.LH</span>(</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> Deptos2022<span class="sc">$</span>Y,   <span class="co"># Variable de estratificación</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">CV =</span> <span class="fl">0.05</span>,          <span class="co"># CV</span></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Ls =</span> <span class="dv">4</span>,             <span class="co"># Estratos</span></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">alloc =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="dv">0</span>),  <span class="co"># Asignación óptima</span></span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">algo =</span> <span class="st">"Kozak"</span>      </span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El comando strata.LH nos da los puntos de corte que definen los estratos y el tamaño de muestra en cada uno.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>Estratificacion<span class="sc">$</span>bh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  33465.0 128840.5 453186.0</code></pre>
</div>
</div>
<p>De esta manera, los estratos quedaron conformados de la siguiente manera: Estrato 1: Y ≤ 33465 Estrato 2: 33465 &lt; Y ≤ 128840.5 Estrato 3: 128840.5 &lt; Y ≤ 453186 Estrato 4: Y &gt; 453186</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>Estratificacion<span class="sc">$</span>nh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  4 11 20 13</code></pre>
</div>
</div>
<p>El comando selecciona entonces 4 unidades del Estrato 1, 11 unidades del Estrato 2, 20 unidades del Estrato 3 y 13 unidades del Estrato 4.</p>
</section>
<section id="nh-y-nh-de-cada-estrato" class="level3">
<h3 class="anchored" data-anchor-id="nh-y-nh-de-cada-estrato">2. Nh y nh de cada estrato</h3>
<p>El nh lo obtuvimos en el ejercicio anterior. Ahora sacaremos el Nh, es decir, el tamaño poblacional de cada estrato. Este valor indica cuántas unidades pertenecen a cada estrato en el marco poblacional. Lo obtienes sumando las unidades dentro de cada estrato una vez los cortes están definidos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">cut</span>(Deptos2022<span class="sc">$</span>Y, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, Estratificacion<span class="sc">$</span>bh, <span class="cn">Inf</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    (-Inf,3.35e+04] (3.35e+04,1.29e+05] (1.29e+05,4.53e+05]     (4.53e+05, Inf] 
                271                 162                  78                  16 </code></pre>
</div>
</div>
<p>Los resultados son: Nh para el Estrato 1: 271 Nh para el Estrato 2: 162 Nh para el Estrato 3: 78 Nh para el Estrato 4: 16</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Creamos la columna de estrato en Deptos2022</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>Deptos2022 <span class="ot">&lt;-</span> Deptos2022 <span class="sc">%&gt;%</span></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>(<span class="at">estrato =</span> <span class="fu">cut</span>(</span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>    Y,</span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, Estratificacion<span class="sc">$</span>bh, <span class="cn">Inf</span>),  </span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(Estratificacion<span class="sc">$</span>bh) <span class="sc">+</span> <span class="dv">1</span>),  </span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.lowest =</span> <span class="cn">TRUE</span></span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb187-10"><a href="#cb187-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Sumamos Nh y nh</span></span>
<span id="cb187-11"><a href="#cb187-11" aria-hidden="true" tabindex="-1"></a>resumen <span class="ot">&lt;-</span> Deptos2022 <span class="sc">%&gt;%</span></span>
<span id="cb187-12"><a href="#cb187-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(estrato) <span class="sc">%&gt;%</span></span>
<span id="cb187-13"><a href="#cb187-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Nh =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb187-14"><a href="#cb187-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nh =</span> Estratificacion<span class="sc">$</span>nh)</span>
<span id="cb187-15"><a href="#cb187-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-16"><a href="#cb187-16" aria-hidden="true" tabindex="-1"></a>resumen</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  estrato    Nh    nh
  &lt;fct&gt;   &lt;int&gt; &lt;dbl&gt;
1 1         271     4
2 2         162    11
3 3          78    20
4 4          16    13</code></pre>
</div>
</div>
</section>
<section id="seleccionamos-una-muestra-con-sampling-mas-en-cada-estrato" class="level3">
<h3 class="anchored" data-anchor-id="seleccionamos-una-muestra-con-sampling-mas-en-cada-estrato">Seleccionamos una muestra con sampling (MAS en cada estrato)</h3>
<p>Realizaremos una muestra aleatoria simple sin reemplazo</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>Deptos2022<span class="sc">$</span>nh <span class="ot">&lt;-</span> <span class="fu">rep</span>(resumen<span class="sc">$</span>nh, <span class="at">times =</span> <span class="fu">table</span>(Deptos2022<span class="sc">$</span>estrato))</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>nh <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">11</span>, <span class="dv">20</span>, <span class="dv">13</span>)</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> sampling<span class="sc">::</span><span class="fu">strata</span>(Deptos2022,</span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">stratanames =</span> <span class="st">"estrato"</span>, </span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> Deptos2022<span class="sc">$</span>nh, <span class="at">method =</span> <span class="st">"srswor"</span>)</span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(s) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    estrato ID_unit       Prob Stratum
12        3      12 0.05128205       1
15        3      15 0.05128205       1
238       3     238 0.05128205       1
342       3     342 0.05128205       1
153       1     153 0.01476015       2
226       1     226 0.01476015       2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extrae las unidades seleccionadas</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>smuestra <span class="ot">&lt;-</span> Deptos2022[s<span class="sc">$</span>ID_unit, ]</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Verifica la composición de la muestra por estrato</span></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(smuestra<span class="sc">$</span>estrato)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
1 2 3 4 
4 4 4 4 </code></pre>
</div>
</div>
<p>El resultado de la tabla muestra que el número de unidades seleccionadas por estrato es el mismo para todos los estratos, siendo 4.</p>
</section>
<section id="declarar-el-diseño-de-muestreo-con-survey" class="level3">
<h3 class="anchored" data-anchor-id="declarar-el-diseño-de-muestreo-con-survey">Declarar el diseño de muestreo con survey</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>diseno <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>,  </span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> <span class="sc">~</span>estrato, </span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> <span class="sc">~</span>nh, </span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data =</span> Deptos2022)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="estimaremos-el-total-de-y-con-el-correspondiente-cv-y-deff." class="level3">
<h3 class="anchored" data-anchor-id="estimaremos-el-total-de-y-con-el-correspondiente-cv-y-deff.">Estimaremos el total de Y, con el correspondiente CV y deff.</h3>
<p>Calculamos primero total de Y con la función de survey</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>total_Y <span class="ot">&lt;-</span> <span class="fu">svytotal</span>(<span class="sc">~</span>Y, <span class="at">design =</span> diseno)</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>total_Y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      total       SE
Y 359925777 28067998</code></pre>
</div>
</div>
<p>La estimación del total de Y en la población es 359925777 y la varianza asociada 28067998</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculamos el CV y el intervalo de confianza</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cv</span>(total_Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Y
Y 0.07798274</code></pre>
</div>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(total_Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      2.5 %    97.5 %
Y 304913511 414938043</code></pre>
</div>
</div>
<p>El CV es 7.8%, lo cual es mayor al 5% que esperabamos, lo cual implica que la estimación tiene una mayor incertidumbre a la esperada.</p>
<p>Con un 95% de confianza, el total de Y en la población se encuentra entre 304913511 y 414938043.</p>
<p>Finalmente sacamos el deff</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>smuestra<span class="sc">$</span>ID_unit <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(smuestra)</span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>smuestra<span class="sc">$</span>peso <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Definir el diseño muestral</span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>diseno <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span>ID_unit, <span class="at">strata =</span> <span class="sc">~</span>estrato, <span class="at">data =</span> smuestra, <span class="at">weights =</span> <span class="sc">~</span>peso )</span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a>deff_value <span class="ot">&lt;-</span> <span class="fu">svymean</span>(<span class="sc">~</span>Y, diseno, <span class="at">deff =</span> <span class="cn">TRUE</span>)</span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a>deff_value</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    mean     SE DEff
Y 213027  15674  Inf</code></pre>
</div>
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a>total_Y <span class="ot">&lt;-</span> <span class="fu">svytotal</span>(<span class="sc">~</span>Y, <span class="at">design =</span> diseno, <span class="at">deff =</span> <span class="cn">TRUE</span>)</span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>total_Y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    total      SE DEff
Y 3408435  250778  Inf</code></pre>
</div>
</div>
<p>El valor Inf (infinito) en el DEFF indica que el diseño no tiene suficiente variabilidad o estructura para calcular un efecto de diseño real.</p>
<p>Dado que es un MAS o tal vez no hay tiene suficientes estratos o variabilidad entre ellos, el DEFF puede ser infinito.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>